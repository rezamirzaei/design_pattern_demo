<div class="pattern-card" id="pattern-prototype" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">üìã</div>
        <div class="pattern-info">
            <h3>Device Configuration Clone</h3>
            <span class="pattern-badge badge-creational">Prototype Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Need to quickly spawn multiple devices with complex settings? The <strong>Prototype Pattern</strong> lets you clone an existing, pre-configured "master" object instead of building new ones from scratch.
    </p>

    <div class="pattern-demo">
        <h4>üéÆ Template Gallery</h4>

        <div class="template-gallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; margin-bottom: 25px;">
            <div class="template-card" onclick="Prototype.clone('ambient-light')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <div class="template-icon" style="font-size: 3.5em; margin-bottom: 15px; background: rgba(255,193,7,0.1); width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin: 0 auto 15px;">üí°</div>
                <div class="template-name" style="font-weight: 700; font-size: 1.2rem; margin-bottom: 15px; color: var(--text);">Ambient Light</div>
                <div class="template-config" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Brightness: 70%</span>
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Color: Warm White (2700K)</span>
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Schedule: Sunset-11PM</span>
                </div>
                <button class="clone-btn" style="width: 100%; padding: 10px 0; background: linear-gradient(90deg, #ffc107, #ff9800); border: none; border-radius: 10px; color: var(--darker); font-weight: 700; font-size: 0.9em; cursor: pointer;">üìã CLONE</button>
            </div>

            <div class="template-card" onclick="Prototype.clone('security-camera')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <div class="template-icon" style="font-size: 3.5em; margin-bottom: 15px; background: rgba(220,53,69,0.1); width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin: 0 auto 15px;">üì∑</div>
                <div class="template-name" style="font-weight: 700; font-size: 1.2rem; margin-bottom: 15px; color: var(--text);">Security Cam</div>
                <div class="template-config" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Resolution: 4K HDR</span>
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Night Vision: Active</span>
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Alerts: Motion + Sound</span>
                </div>
                <button class="clone-btn" style="width: 100%; padding: 10px 0; background: linear-gradient(90deg, #dc3545, #c82333); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer;">üìã CLONE</button>
            </div>

            <div class="template-card" onclick="Prototype.clone('eco-thermostat')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; text-align: center; cursor: pointer; transition: all 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                <div class="template-icon" style="font-size: 3.5em; margin-bottom: 15px; background: rgba(40,167,69,0.1); width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin: 0 auto 15px;">üå°Ô∏è</div>
                <div class="template-name" style="font-weight: 700; font-size: 1.2rem; margin-bottom: 15px; color: var(--text);">Eco Thermostat</div>
                <div class="template-config" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Mode: Eco-Saver</span>
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Day/Night: 21¬∞C / 18¬∞C</span>
                    <span class="config-item" style="font-size: 0.85em; color: var(--text-muted); padding: 5px 10px; background: rgba(0,0,0,0.2); border-radius: 8px;">Sensor: Occupancy</span>
                </div>
                <button class="clone-btn" style="width: 100%; padding: 10px 0; background: linear-gradient(90deg, #28a745, #218838); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer;">üìã CLONE</button>
            </div>
        </div>

        <div class="cloned-devices" style="padding: 25px; background: rgba(0,0,0,0.2); border-radius: 15px; border: 1px solid var(--glass-border);">
            <h5 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">üì¶ Clone Inventory</h5>
            <div class="cloned-list" id="cloned-devices-list" style="display: flex; flex-direction: column; gap: 10px;">
                <div class="no-clones" style="text-align: center; color: var(--text-muted); padding: 20px; font-style: italic;">
                    Select a master template above to spawn a clone...
                </div>
            </div>
        </div>

        <div class="pattern-explanation" style="margin-top: 25px;">
            <h5>üí° Pattern Logic</h5>
            <ul>
                <li><strong>Prototype Interface:</strong> Defines `clone()` method.</li>
                <li><strong>Concrete Prototype:</strong> Implements `clone()` to perform deep copy of complex config (wifi, schedules, thresholds).</li>
                <li><strong>Efficiency:</strong> Avoids database/network overhead of constructing new objects from scratch.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="prototype-result"></div>
</div>
<script>
var Prototype = {
    cloneCount: 0,
    clone: function(template) {
        this.cloneCount++;
        var templates = {
            'ambient-light': {icon:'üí°',name:'Ambient Light',config:'Warm, 70%, Sunset-11PM', color: '#ffc107'},
            'security-camera': {icon:'üì∑',name:'Security Camera',config:'4K, Night Vision, Alerts', color: '#dc3545'},
            'eco-thermostat': {icon:'üå°Ô∏è',name:'Eco Thermostat',config:'Eco Mode, 21¬∞C/18¬∞C', color: '#28a745'}
        };

        var t = templates[template];
        var list = document.getElementById('cloned-devices-list');
        var noClones = list.querySelector('.no-clones');
        if (noClones) noClones.remove();

        // Create new element with animation
        var cloneId = 'clone-' + this.cloneCount;
        var clone = document.createElement('div');
        clone.className = 'cloned-item';
        clone.id = cloneId;
        clone.style.cssText = 'display: flex; align-items: center; gap: 15px; padding: 15px 20px; background: rgba(255,255,255,0.03); border-radius: 12px; border-left: 4px solid ' + t.color + '; animation: slideIn 0.3s ease-out;';

        clone.innerHTML =
            '<span class="ci-icon" style="font-size: 1.5em; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">' + t.icon + '</span>' +
            '<div style="flex: 1;">' +
                '<span class="ci-name" style="font-weight: 600; display: block; font-size: 1rem;">' + t.name + ' <span style="font-size:0.8em; color:var(--text-muted); font-weight:400;">(Clone #' + this.cloneCount + ')</span></span>' +
                '<span class="ci-config" style="font-size: 0.85em; color: var(--text-muted);">' + t.config + '</span>' +
            '</div>' +
            '<span class="ci-status" style="color: var(--success); font-size: 0.85em; display: flex; align-items: center; gap: 5px;">‚úÖ Ready</span>';

        list.prepend(clone);

        // Simulate API call
        fetch('/api/patterns/prototype/clone?templateId=' + template, {method:'POST'})
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var output = 'üß¨ Cloning Process Complete\n' +
                             '--------------------------------\n' +
                             'Source: ' + t.name + ' Template\n' +
                             'Status: Deep Copy Successful\n' +
                             'New Instance ID: ' + (data.id || 'CLONE-' + Math.floor(Math.random()*10000)) + '\n' +
                             'Config Migrated: 100%';

                PatternDemo.showResult('prototype-result', output);
                PatternDemo.toast('Cloned ' + t.name, 'success');
            });
    }
};
</script>
</div>
