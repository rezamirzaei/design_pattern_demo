<div class="pattern-card" id="pattern-prototype" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸ“‹</div>
        <div class="pattern-info">
            <h3>Device Configuration Clone</h3>
            <span class="pattern-badge badge-creational">Prototype Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Need to quickly spawn multiple devices with complex settings? The <strong>Prototype Pattern</strong> lets you clone an existing, pre-configured "master" object instead of building new ones from scratch.
    </p>

    <div class="pattern-demo">
        <h4>ğŸ® Template Gallery</h4>

        <div class="pd-selector pd-selector--xl" style="margin-bottom:30px">
            <div class="pd-panel pd-proto-card" onclick="Prototype.clone('ambient-light')">
                <span class="pd-chip pd-chip--primary" style="position:absolute;top:12px;right:12px">MASTER</span>
                <div class="pd-icon-circle pd-icon-circle--lg" style="margin:0 auto 15px;background:rgba(255,193,7,0.1);border-color:rgba(255,193,7,0.3)">ğŸ’¡</div>
                <div class="pd-sel-label" style="margin-bottom:12px">Ambient Light</div>
                <div class="pd-proto-config">
                    <span class="pd-chip">Brightness: 70%</span>
                    <span class="pd-chip">Color: Warm (2700K)</span>
                    <span class="pd-chip">Schedule: Sunset</span>
                </div>
                <button class="pd-btn-action" style="margin-top:15px;background:linear-gradient(135deg,#ffc107,#ff9800);color:#000">ğŸ“‹ CLONE</button>
            </div>

            <div class="pd-panel pd-proto-card" onclick="Prototype.clone('security-camera')">
                <span class="pd-chip" style="position:absolute;top:12px;right:12px;border-color:rgba(220,53,69,0.3);color:#dc3545">MASTER</span>
                <div class="pd-icon-circle pd-icon-circle--lg" style="margin:0 auto 15px;background:rgba(220,53,69,0.1);border-color:rgba(220,53,69,0.3)">ğŸ“·</div>
                <div class="pd-sel-label" style="margin-bottom:12px">Security Cam</div>
                <div class="pd-proto-config">
                    <span class="pd-chip">Res: 4K HDR</span>
                    <span class="pd-chip">Night Vision: ON</span>
                    <span class="pd-chip">Alerts: Motion</span>
                </div>
                <button class="pd-btn-action" style="margin-top:15px;background:linear-gradient(135deg,#dc3545,#c82333)">ğŸ“‹ CLONE</button>
            </div>

            <div class="pd-panel pd-proto-card" onclick="Prototype.clone('eco-thermostat')">
                <span class="pd-chip" style="position:absolute;top:12px;right:12px;border-color:rgba(40,167,69,0.3);color:#28a745">MASTER</span>
                <div class="pd-icon-circle pd-icon-circle--lg" style="margin:0 auto 15px;background:rgba(40,167,69,0.1);border-color:rgba(40,167,69,0.3)">ğŸŒ¡ï¸</div>
                <div class="pd-sel-label" style="margin-bottom:12px">Eco Thermostat</div>
                <div class="pd-proto-config">
                    <span class="pd-chip">Mode: Eco-Saver</span>
                    <span class="pd-chip">Temps: 21Â°C / 18Â°C</span>
                    <span class="pd-chip">Sensor: Occupancy</span>
                </div>
                <button class="pd-btn-action" style="margin-top:15px;background:linear-gradient(135deg,#28a745,#218838)">ğŸ“‹ CLONE</button>
            </div>
        </div>

        <div class="pd-panel">
            <h5 class="pd-panel-header">ğŸ“¦ Clone Inventory</h5>
            <div id="cloned-devices-list" class="pd-suite-grid">
                <div class="no-clones" style="grid-column:1/-1;text-align:center;color:var(--text-muted);padding:30px;font-style:italic;opacity:0.6">
                    Select a master template above to spawn a clone...
                </div>
            </div>
        </div>

        <div class="pattern-explanation">
            <h5>ğŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Prototype Interface:</strong> Defines <code>clone()</code> method.</li>
                <li><strong>Concrete Prototype:</strong> Implements <code>clone()</code> to perform deep copy of complex config.</li>
                <li><strong>Efficiency:</strong> Avoids database/network overhead of constructing new objects from scratch.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="prototype-result"></div>
<script>
var Prototype = {
    cloneCount: 0,
    clone: function(template) {
        this.cloneCount++;
        var templates = {
            'ambient-light': {icon:'ğŸ’¡',name:'Ambient Light',config:'Warm, 70%, Sunset-11PM', color:'#ffc107'},
            'security-camera': {icon:'ğŸ“·',name:'Security Camera',config:'4K, Night Vision, Alerts', color:'#dc3545'},
            'eco-thermostat': {icon:'ğŸŒ¡ï¸',name:'Eco Thermostat',config:'Eco Mode, 21Â°C/18Â°C', color:'#28a745'}
        };
        var t = templates[template];
        var list = document.getElementById('cloned-devices-list');
        var noClones = list.querySelector('.no-clones');
        if (noClones) noClones.remove();
        var clone = document.createElement('div');
        clone.className = 'pd-suite-device';
        clone.style.borderLeft = '4px solid ' + t.color;
        clone.style.flexDirection = 'row';
        clone.style.gap = '12px';
        clone.innerHTML = '<span class="pd-sel-icon">' + t.icon + '</span><div><span class="pd-sel-label">' + t.name + ' (Clone #' + this.cloneCount + ')</span><span class="pd-sel-desc">' + t.config + '</span></div>';
        list.prepend(clone);
        fetch('/api/patterns/prototype/clone?template=' + encodeURIComponent(template), {method:'POST'})
            .then(function(r) { return r.json(); })
            .then(function(data) {
                PatternDemo.showResult('prototype-result', 'ğŸ§¬ Clone Complete\nSource: ' + t.name + '\nID: ' + (data.cloneId || data.id || 'CLONE-' + Math.floor(Math.random()*10000)));
                PatternDemo.toast('Cloned ' + t.name, 'success');
            });
    }
};
</script>
</div>
