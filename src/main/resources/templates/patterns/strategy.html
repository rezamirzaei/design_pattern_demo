<div class="pattern-card" id="pattern-strategy" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">‚ö°</div>
        <div class="pattern-info">
            <h3>Energy Management Strategy</h3>
            <span class="pattern-badge badge-behavioral">Strategy Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">Switch between different <strong>energy management algorithms</strong> at runtime. Normal, Eco, or Performance mode - same interface, different strategies!</p>
    <div class="pattern-demo">
        <h4>üéÆ Select Energy Strategy</h4>
        <div class="strategy-selector">
            <button class="strategy-btn active" id="strat-normal" onclick="Strategy.select('NORMAL')">
                <span class="sb-icon">‚ö°</span>
                <span class="sb-name">Normal</span>
                <span class="sb-power">100% Power</span>
                <div class="sb-details">
                    <span>üí° Lights: Full brightness</span>
                    <span>üå°Ô∏è Climate: Comfort (22¬∞C)</span>
                    <span>üì∫ Devices: Always on</span>
                </div>
            </button>
            <button class="strategy-btn" id="strat-eco" onclick="Strategy.select('ECO')">
                <span class="sb-icon">üåø</span>
                <span class="sb-name">Eco</span>
                <span class="sb-power">70% Power</span>
                <div class="sb-details">
                    <span>üí° Lights: Dimmed 30%</span>
                    <span>üå°Ô∏è Climate: Efficient (20¬∞C)</span>
                    <span>üì∫ Devices: Auto-off when idle</span>
                </div>
            </button>
            <button class="strategy-btn" id="strat-performance" onclick="Strategy.select('PERFORMANCE')">
                <span class="sb-icon">üöÄ</span>
                <span class="sb-name">Performance</span>
                <span class="sb-power">130% Power</span>
                <div class="sb-details">
                    <span>üí° Lights: Maximum</span>
                    <span>üå°Ô∏è Climate: Instant (max)</span>
                    <span>üì∫ Devices: Pre-heated/ready</span>
                </div>
            </button>
        </div>
        <div class="strategy-dashboard">
            <div class="dash-stat">
                <div class="stat-circle" id="power-circle">
                    <span class="stat-value" id="power-value">100</span>
                    <span class="stat-unit">%</span>
                </div>
                <span class="stat-label">Power Usage</span>
            </div>
            <div class="dash-stat">
                <div class="stat-circle" id="cost-circle">
                    <span class="stat-value" id="cost-value">$2.50</span>
                </div>
                <span class="stat-label">Est. Daily Cost</span>
            </div>
            <div class="dash-stat">
                <div class="stat-circle" id="carbon-circle">
                    <span class="stat-value" id="carbon-value">5kg</span>
                </div>
                <span class="stat-label">CO‚ÇÇ / Day</span>
            </div>
        </div>
        <div class="strategy-devices">
            <h5>üìä Strategy Applied To</h5>
            <div class="affected-devices">
                <div class="affected-item"><span>üí°</span> 8 Lights</div>
                <div class="affected-item"><span>üå°Ô∏è</span> 3 Thermostats</div>
                <div class="affected-item"><span>üì∫</span> 2 TVs</div>
                <div class="affected-item"><span>üîå</span> 5 Outlets</div>
            </div>
        </div>
        <div class="pattern-explanation">
            <h5>üí° How Strategy Works:</h5>
            <ul>
                <li><strong>Strategy Interface</strong>: defines calculatePower(), optimizeDevices()</li>
                <li><strong>Concrete Strategies</strong>: NormalStrategy, EcoStrategy, PerformanceStrategy</li>
                <li><strong>Context</strong>: EnergyManager holds reference to current strategy</li>
                <li>Strategies are interchangeable at runtime</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="strategy-result"></div>
</div>
<script>
var Strategy = {
    current: 'NORMAL',
    select: function(strategy) {
        this.current = strategy;
        document.querySelectorAll('.strategy-btn').forEach(function(b) { b.classList.remove('active'); });
        document.getElementById('strat-' + strategy.toLowerCase()).classList.add('active');
        var settings = {
            NORMAL: {power:100, cost:'$2.50', carbon:'5kg', color:'#00d2ff'},
            ECO: {power:70, cost:'$1.75', carbon:'3.5kg', color:'#28a745'},
            PERFORMANCE: {power:130, cost:'$3.25', carbon:'6.5kg', color:'#ffc107'}
        };
        var s = settings[strategy];
        document.getElementById('power-value').textContent = s.power;
        document.getElementById('cost-value').textContent = s.cost;
        document.getElementById('carbon-value').textContent = s.carbon;
        document.querySelectorAll('.stat-circle').forEach(function(c) {
            c.style.borderColor = s.color;
            c.style.boxShadow = '0 0 20px ' + s.color + '40';
        });
        fetch('/api/patterns/strategy/apply?strategy=' + strategy, {method:'POST'})
            .then(function(r) { return r.json(); })
            .then(function(data) {
                PatternDemo.showResult('strategy-result', 'Strategy changed to: ' + strategy + '\n\nPower: ' + s.power + '%\nEst. Cost: ' + s.cost + '/day\nCarbon: ' + s.carbon + '/day\n\nThe Strategy pattern swapped the algorithm at runtime.\nAll devices now use ' + strategy + ' energy management.\n\n' + JSON.stringify(data, null, 2));
                PatternDemo.toast('Strategy: ' + strategy, 'success');
            });
    }
};
</script>
<style>
.strategy-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
.strategy-btn { display: flex; flex-direction: column; align-items: center; padding: 20px; background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 15px; color: white; cursor: pointer; transition: all 0.3s; text-align: center; }
.strategy-btn:hover { background: rgba(0,210,255,0.1); border-color: rgba(0,210,255,0.3); transform: translateY(-3px); }
.strategy-btn.active { background: rgba(0,210,255,0.15); border-color: #00d2ff; }
#strat-eco.active { background: rgba(40,167,69,0.15); border-color: #28a745; }
#strat-performance.active { background: rgba(255,193,7,0.15); border-color: #ffc107; }
.sb-icon { font-size: 2.5em; margin-bottom: 10px; }
.sb-name { font-size: 1.2em; font-weight: 600; margin-bottom: 5px; }
.sb-power { font-size: 0.9em; color: #00d2ff; margin-bottom: 12px; }
#strat-eco .sb-power { color: #28a745; }
#strat-performance .sb-power { color: #ffc107; }
.sb-details { display: flex; flex-direction: column; gap: 5px; font-size: 0.8em; color: #888; }
.strategy-dashboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
.dash-stat { text-align: center; }
.stat-circle { width: 100px; height: 100px; border-radius: 50%; border: 3px solid #00d2ff; display: flex; flex-direction: column; align-items: center; justify-content: center; margin: 0 auto 10px; transition: all 0.3s; box-shadow: 0 0 20px rgba(0,210,255,0.3); }
.stat-value { font-size: 1.5em; font-weight: bold; }
.stat-unit { font-size: 0.8em; color: #888; }
.stat-label { font-size: 0.85em; color: #888; }
.strategy-devices { padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px; }
.strategy-devices h5 { color: #888; margin-bottom: 12px; }
.affected-devices { display: flex; flex-wrap: wrap; gap: 10px; }
.affected-item { padding: 8px 14px; background: rgba(255,255,255,0.05); border-radius: 20px; font-size: 0.9em; }
.affected-item span { margin-right: 5px; }
@media (max-width: 768px) { .strategy-selector { grid-template-columns: 1fr; } }
</style>
</div>
