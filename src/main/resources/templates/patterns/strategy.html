<div class="pattern-card" id="pattern-strategy" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">âš¡</div>
        <div class="pattern-info">
            <h3>Energy Optimizer</h3>
            <span class="pattern-badge badge-behavioral">Strategy Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Define a family of algorithms (e.g., energy profiles), encapsulate each one, and make them interchangeable.
        <strong>Strategy</strong> lets the algorithm vary independently from clients that use it.
    </p>

    <div class="pattern-demo">
        <h4>ðŸŽ® Mode Selector</h4>

        <div class="strategy-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 25px;">
            <div class="strategy-btn active" id="strat-normal" onclick="Strategy.select('NORMAL')" style="position: relative; padding: 25px; background: rgba(0, 210, 255, 0.1); border: 2px solid var(--primary); border-radius: 15px; cursor: pointer; text-align: center; transition: all 0.3s; overflow: hidden;">
                <div class="sb-icon" style="font-size: 3em; margin-bottom: 15px; text-shadow: 0 0 20px rgba(0, 210, 255, 0.5);">âš¡</div>
                <div class="sb-name" style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">Balanced</div>
                <div class="sb-power" style="color: var(--primary); font-family: monospace; font-weight: bold;">100% Usage</div>
                <div class="sb-details" style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed rgba(255,255,255,0.1); font-size: 0.85em; text-align: left; color: var(--text-muted); display: flex; flex-direction: column; gap: 5px;">
                    <span>âœ“ Standard Brightness</span>
                    <span>âœ“ Comfort Temp (22Â°C)</span>
                </div>
            </div>

            <button class="strategy-btn" id="strat-eco" onclick="Strategy.select('ECO')" style="position: relative; padding: 25px; background: rgba(255, 255, 255, 0.03); border: 2px solid var(--glass-border); border-radius: 15px; cursor: pointer; text-align: center; transition: all 0.3s; overflow: hidden;">
                <div class="sb-icon" style="font-size: 3em; margin-bottom: 15px; filter: grayscale(100%);">ðŸŒ¿</div>
                <div class="sb-name" style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">Eco Saver</div>
                <div class="sb-power" style="color: var(--success); font-family: monospace; font-weight: bold;">70% Usage</div>
                <div class="sb-details" style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed rgba(255,255,255,0.1); font-size: 0.85em; text-align: left; color: var(--text-muted); display: flex; flex-direction: column; gap: 5px;">
                    <span>âœ“ Dimmed Lights</span>
                    <span>âœ“ Eco Temp (20Â°C)</span>
                </div>
            </button>

            <button class="strategy-btn" id="strat-performance" onclick="Strategy.select('PERFORMANCE')" style="position: relative; padding: 25px; background: rgba(255, 255, 255, 0.03); border: 2px solid var(--glass-border); border-radius: 15px; cursor: pointer; text-align: center; transition: all 0.3s; overflow: hidden;">
                <div class="sb-icon" style="font-size: 3em; margin-bottom: 15px; filter: grayscale(100%);">ðŸš€</div>
                <div class="sb-name" style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">High Performance</div>
                <div class="sb-power" style="color: var(--warning); font-family: monospace; font-weight: bold;">130% Usage</div>
                <div class="sb-details" style="margin-top: 15px; padding-top: 15px; border-top: 1px dashed rgba(255,255,255,0.1); font-size: 0.85em; text-align: left; color: var(--text-muted); display: flex; flex-direction: column; gap: 5px;">
                    <span>âœ“ Max Brightness</span>
                    <span>âœ“ Instant Heat/Cool</span>
                </div>
            </button>
        </div>

        <div class="strategy-dashboard" style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 25px;">
            <div class="dash-stat" style="flex: 1; background: var(--darker); padding: 20px; border-radius: 15px; border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: center; gap: 20px;">
                <div class="stat-circle" id="power-circle" style="width: 80px; height: 80px; border-radius: 50%; border: 4px solid var(--primary); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; color: var(--text); box-shadow: 0 0 20px rgba(0,210,255,0.3); transition: all 0.5s;">
                    <span id="power-value">100</span>%
                </div>
                <div style="text-align: left;">
                    <div style="font-size: 0.9em; color: var(--text-muted); text-transform: uppercase;">Energy Load</div>
                    <div style="font-size: 1.5em; font-weight: 700; color: var(--text);">Real-time</div>
                </div>
            </div>

            <div class="dash-stat" style="flex: 1; background: var(--darker); padding: 20px; border-radius: 15px; border: 1px solid var(--glass-border); display: flex; align-items: center; justify-content: center; gap: 20px;">
                <div class="stat-circle" id="cost-circle" style="width: 80px; height: 80px; border-radius: 50%; border: 4px solid var(--primary); display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1em; color: var(--text); box-shadow: 0 0 20px rgba(0,210,255,0.3); transition: all 0.5s;">
                    <span id="cost-value">$2.50</span>
                </div>
                <div style="text-align: left;">
                    <div style="font-size: 0.9em; color: var(--text-muted); text-transform: uppercase;">Est. Cost</div>
                    <div style="font-size: 1.5em; font-weight: 700; color: var(--text);">Daily Avg</div>
                </div>
            </div>
        </div>

        <div class="pattern-explanation" style="margin-top: 25px;">
            <h5>ðŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Context:</strong> `HomeEnergyManager` class uses a Strategy object.</li>
                <li><strong>Strategy Interface:</strong> `EnergyStrategy` with method `executeOptimize()`.</li>
                <li><strong>Concrete Strategies:</strong> `EcoStrategy`, `NormalStrategy`. The context can switch these at runtime.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="strategy-result"></div>
</div>
<script>
var Strategy = {
    current: 'NORMAL',
    select: function(strategy) {
        this.current = strategy;

        // UI Updates
        document.querySelectorAll('.strategy-btn').forEach(function(b) {
            b.classList.remove('active');
            b.style.background = 'rgba(255, 255, 255, 0.03)';
            b.style.borderColor = 'var(--glass-border)';
            b.querySelector('.sb-icon').style.textShadow = 'none';
            b.querySelector('.sb-icon').style.filter = 'grayscale(100%)';
        });

        var activeBtn = document.getElementById('strat-' + strategy.toLowerCase());

        var settings = {
            NORMAL: {power:100, cost:'$2.50', color:'var(--primary)', bg:'rgba(0, 210, 255, 0.1)'},
            ECO: {power:70, cost:'$1.75', color:'var(--success)', bg:'rgba(40, 167, 69, 0.1)'},
            PERFORMANCE: {power:130, cost:'$3.25', color:'var(--warning)', bg:'rgba(255, 193, 7, 0.1)'}
        };
        var s = settings[strategy];

        activeBtn.classList.add('active');
        activeBtn.style.background = s.bg;
        activeBtn.style.borderColor = s.color;
        activeBtn.style.transform = 'scale(1.02)';
        activeBtn.querySelector('.sb-icon').style.textShadow = '0 0 20px ' + s.color;
        activeBtn.querySelector('.sb-icon').style.filter = 'none';
        setTimeout(() => activeBtn.style.transform = 'scale(1)', 200);

        // Animate stats
        document.getElementById('power-value').textContent = s.power;
        document.getElementById('cost-value').textContent = s.cost;

        document.querySelectorAll('.stat-circle').forEach(function(c) {
            c.style.borderColor = s.color;
            c.style.boxShadow = '0 0 20px ' + s.color;
        });

        // API Call
        fetch('/api/patterns/strategy/apply?strategy=' + strategy, {method:'POST'})
            .then(function(r) { return r.json(); })
            .then(function(data) {
                PatternDemo.showResult('strategy-result', 'ðŸ”Œ Strategy Swapped: ' + strategy + '\n' +
                    '-------------------------\n' +
                    'Algorithm replaced successfully.\n' +
                    'New Power Profile: ' + s.power + '% Load');
                PatternDemo.toast('Switched to ' + strategy, 'success');
            });
    }
};
</script>
</div>
