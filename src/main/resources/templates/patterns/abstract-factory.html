<div class="pattern-card" id="pattern-abstract-factory" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">üè¢</div>
        <div class="pattern-info">
            <h3>Ecosystem Factory</h3>
            <span class="pattern-badge badge-creational">Abstract Factory</span>
        </div>
    </div>
    <p class="pattern-desc">
        Need to ensure all your devices play nice together? The <strong>Abstract Factory</strong> creates entire families of related objects (SmartThings, HomeKit, Google) without specifying their concrete classes, ensuring compatibility.
    </p>

    <div class="pattern-demo">
        <h4>üéÆ Select an Ecosystem</h4>

        <div style="display:flex; gap: 12px; align-items: center; margin-bottom: 20px;">
            <label for="af-location" style="color: var(--text-muted); text-transform: uppercase; font-size: 0.85em; letter-spacing: 1px; font-weight: 700;">Location</label>
            <input id="af-location" class="form-input" value="Living Room" placeholder="Living Room"
                   style="flex: 1; padding: 12px 16px; border-radius: 10px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: var(--text);">
        </div>

        <div class="ecosystem-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <button class="action-btn" onclick="AbstractFactory.create('SMARTTHINGS')" style="display: flex; align-items: center; gap: 20px; padding: 25px; background: var(--darker); border: 1px solid var(--glass-border); border-radius: 16px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s; position: relative; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                <div class="eco-icon" style="font-size: 2.5em; background: rgba(58, 123, 213, 0.15); padding: 15px; border-radius: 12px; border: 1px solid #3a7bd5;">üî∑</div>
                <div class="eco-info" style="flex: 1;">
                    <div class="eco-name" style="font-weight: 700; font-size: 1.25em; margin-bottom: 6px; color: #3a7bd5;">SmartThings</div>
                    <div class="eco-desc" style="font-size: 0.9em; color: var(--text-muted); line-height: 1.4;">Hub-based ecosystem. Reliable mesh network with Zigbee/Z-Wave.</div>
                </div>
            </button>

            <button class="action-btn" onclick="AbstractFactory.create('HOMEKIT')" style="display: flex; align-items: center; gap: 20px; padding: 25px; background: var(--darker); border: 1px solid var(--glass-border); border-radius: 16px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s; position: relative; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                <div class="eco-icon" style="font-size: 2.5em; background: rgba(255, 255, 255, 0.15); padding: 15px; border-radius: 12px; border: 1px solid white;">üçé</div>
                <div class="eco-info" style="flex: 1;">
                    <div class="eco-name" style="font-weight: 700; font-size: 1.25em; margin-bottom: 6px; color: white;">Apple HomeKit</div>
                    <div class="eco-desc" style="font-size: 0.9em; color: var(--text-muted); line-height: 1.4;">Privacy-focused ecosystem. Local processing with HomePod.</div>
                </div>
            </button>

            <button class="action-btn" onclick="AbstractFactory.create('GOOGLE')" style="display: flex; align-items: center; gap: 20px; padding: 25px; background: var(--darker); border: 1px solid var(--glass-border); border-radius: 16px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s; position: relative; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.2);">
                <div class="eco-icon" style="font-size: 2.5em; background: rgba(220, 53, 69, 0.15); padding: 15px; border-radius: 12px; border: 1px solid #dc3545;">üî¥</div>
                <div class="eco-info" style="flex: 1;">
                    <div class="eco-name" style="font-weight: 700; font-size: 1.25em; margin-bottom: 6px; color: #dc3545;">Google Home</div>
                    <div class="eco-desc" style="font-size: 0.9em; color: var(--text-muted); line-height: 1.4;">Cloud-centric ecosystem. Integrated Nest AI & Assistant.</div>
                </div>
            </button>
        </div>

        <div class="created-suite" id="af-created-suite" style="display:none; margin-top: 30px; padding: 30px; background: var(--darker); border-radius: 16px; border: 1px solid var(--glass-border); position: relative;">
            <div style="position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary), var(--secondary)); border-radius: 16px 16px 0 0;"></div>
            <h5 style="color: var(--primary); margin-bottom: 25px; display: flex; align-items: center; gap: 10px; font-size: 1.1em; text-transform: uppercase; letter-spacing: 1px;">
                üì¶ Provisioned Device Family
            </h5>
            <div class="suite-devices" id="af-suite-devices" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 20px;"></div>
        </div>

        <div class="pattern-explanation" style="margin-top: 25px;">
            <h5>üí° Pattern Logic</h5>
            <ul>
                <li><strong>Abstract Factory:</strong> Interface `SmartHomeFactory` declares methods for creating abstract products.</li>
                <li><strong>Concrete Factory:</strong> `HomeKitFactory` implements creation methods to produce HomeKit-specific devices.</li>
                <li><strong>Constraint:</strong> A client using `HomeKitFactory` can ONLY create HomeKit devices, ensuring the whole suite works together.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="abstract-factory-result"></div>
</div>
<script>
var AbstractFactory = {
    create: function(ecosystem) {
        var location = (document.getElementById('af-location')?.value || 'Living Room').trim();
        if (!location) location = 'Living Room';

        // Updated colors and icons for pro look
        var dataMap = {
            SMARTTHINGS: { color: '#3a7bd5', info: 'Samsung SmartThings Protocol' },
            HOMEKIT: { color: '#ffffff', info: 'Apple HomeKit Secure Protocol' },
            GOOGLE: { color: '#dc3545', info: 'Google Weave Protocol' }
        };

        var meta = dataMap[ecosystem];
        if (!meta) meta = dataMap.SMARTTHINGS;

        var suiteArea = document.getElementById('af-created-suite');
        suiteArea.style.display = 'block';
        suiteArea.style.borderColor = meta.color;
        suiteArea.style.background = meta.color + '10'; // 10% opacity

        PatternDemo.showResult('abstract-factory-result', 'üèóÔ∏è Initializing ' + ecosystem + ' Abstract Factory...\n' +
            '----------------------------------------\n' +
            '1. Factory Instance: ' + ecosystem.charAt(0) + ecosystem.slice(1).toLowerCase() + 'Factory\n' +
            '2. Protocol: ' + meta.info + '\n' +
            '3. Provisioning Device Family at "' + location + '"...\n' +
            '4. Calling backend...');

        fetch('/api/patterns/abstract-factory/create?ecosystem=' + encodeURIComponent(ecosystem) + '&location=' + encodeURIComponent(location), { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(devices) {
                var container = document.getElementById('af-suite-devices');
                var iconsByType = { LIGHT: 'üí°', THERMOSTAT: 'üå°Ô∏è', LOCK: 'üîí', SENSOR: 'üì°', CAMERA: 'üì∑' };

                container.innerHTML = (devices || []).map(function(d) {
                    var icon = iconsByType[d.type] || 'üì¶';
                    return '<div class="suite-device" style="flex: 1; min-width: 120px; display: flex; flex-direction: column; align-items: center; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid var(--glass-border);">' +
                        '<span class="sd-icon" style="font-size: 2.5em; margin-bottom: 10px;">' + icon + '</span>' +
                        '<span class="sd-name" style="font-weight: 600; font-size: 0.9em; text-align: center;">' + (d.info || d.id) + '</span>' +
                        '<span class="sd-type" style="font-size: 0.75em; color: var(--text-muted); margin-top: 4px;">' + d.type + '</span>' +
                        '</div>';
                }).join('');

                PatternDemo.showResult('abstract-factory-result', '‚úÖ Device Family Created\n' +
                    '-----------------------\n' +
                    'Ecosystem: ' + ecosystem + '\n' +
                    'Location: ' + location + '\n' +
                    'Devices: ' + (devices ? devices.length : 0));
                PatternDemo.toast(ecosystem + ' Family Created', 'success');
            })
            .catch(function(e) {
                PatternDemo.showResult('abstract-factory-result', { error: (e && e.message) ? e.message : 'Request failed' });
                PatternDemo.toast('Abstract Factory failed', 'error');
            });
    }
};
</script>
</div>
