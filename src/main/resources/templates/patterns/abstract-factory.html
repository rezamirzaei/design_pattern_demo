<div class="pattern-card" id="pattern-abstract-factory" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸ¢</div>
        <div class="pattern-info">
            <h3>Ecosystem Factory</h3>
            <span class="pattern-badge badge-creational">Abstract Factory</span>
        </div>
    </div>
    <p class="pattern-desc">
        The <strong>Abstract Factory</strong> creates entire families of related objects (SmartThings, HomeKit, Google) without specifying their concrete classes, ensuring compatibility.
    </p>

    <div class="pattern-demo">
        <h4>ğŸ® Select an Ecosystem</h4>

        <div class="pd-form-row" style="margin-bottom:20px; align-items:center">
            <div>
                <label for="af-location" class="pd-form-label">Location</label>
                <input id="af-location" class="pd-input" value="Living Room" placeholder="Living Room">
            </div>
        </div>

        <div class="pd-selector pd-selector--xl" style="margin-bottom:30px">
            <button class="pd-eco-card" onclick="AbstractFactory.create('SMARTTHINGS')">
                <div class="pd-eco-icon" style="background:rgba(58,123,213,0.15); border:1px solid #3a7bd5">ğŸ”·</div>
                <div>
                    <span class="pd-eco-name" style="color:#3a7bd5">SmartThings</span>
                    <span class="pd-eco-desc">Hub-based. Reliable Zigbee/Z-Wave mesh.</span>
                </div>
            </button>
            <button class="pd-eco-card" onclick="AbstractFactory.create('HOMEKIT')">
                <div class="pd-eco-icon" style="background:rgba(255,255,255,0.15); border:1px solid #fff">ğŸ</div>
                <div>
                    <span class="pd-eco-name" style="color:#fff">Apple HomeKit</span>
                    <span class="pd-eco-desc">Privacy-focused. Local processing with HomePod.</span>
                </div>
            </button>
            <button class="pd-eco-card" onclick="AbstractFactory.create('GOOGLE')">
                <div class="pd-eco-icon" style="background:rgba(220,53,69,0.15); border:1px solid #dc3545">ğŸ”´</div>
                <div>
                    <span class="pd-eco-name" style="color:#dc3545">Google Home</span>
                    <span class="pd-eco-desc">Cloud-centric. Integrated Nest AI & Assistant.</span>
                </div>
            </button>
        </div>

        <div class="pd-panel" id="af-created-suite" style="display:none; position:relative">
            <div style="position:absolute; top:0; left:0; right:0; height:4px; background:linear-gradient(90deg,var(--primary),var(--secondary)); border-radius:16px 16px 0 0"></div>
            <h5 class="pd-panel-header">ğŸ“¦ Provisioned Device Family</h5>
            <div class="pd-suite-grid" id="af-suite-devices"></div>
        </div>

        <div class="pattern-explanation">
            <h5>ğŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Abstract Factory:</strong> Interface <code>SmartHomeFactory</code> declares methods for creating abstract products.</li>
                <li><strong>Concrete Factory:</strong> <code>HomeKitFactory</code> implements creation methods to produce HomeKit-specific devices.</li>
                <li><strong>Constraint:</strong> A client using <code>HomeKitFactory</code> can ONLY create HomeKit devices, ensuring compatibility.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="abstract-factory-result"></div>
<script>
var AbstractFactory = {
    create: function(ecosystem) {
        var location = (document.getElementById('af-location')?.value || 'Living Room').trim() || 'Living Room';
        var suiteArea = document.getElementById('af-created-suite');
        suiteArea.style.display = 'block';
        PatternDemo.showResult('abstract-factory-result', 'ğŸ—ï¸ Initializing ' + ecosystem + ' Abstract Factory...');
        fetch('/api/patterns/abstract-factory/create?ecosystem=' + encodeURIComponent(ecosystem) + '&location=' + encodeURIComponent(location), { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(devices) {
                var container = document.getElementById('af-suite-devices');
                var iconsByType = { LIGHT:'ğŸ’¡', THERMOSTAT:'ğŸŒ¡ï¸', LOCK:'ğŸ”’', SENSOR:'ğŸ“¡', CAMERA:'ğŸ“·' };
                container.innerHTML = (devices || []).map(function(d) {
                    return '<div class="pd-suite-device"><span class="pd-sel-icon">' + (iconsByType[d.type]||'ğŸ“¦') + '</span><span class="pd-sel-label">' + (d.info||d.id) + '</span><span class="pd-sel-desc">' + d.type + '</span></div>';
                }).join('');
                PatternDemo.showResult('abstract-factory-result', 'âœ… Device Family Created\nEcosystem: ' + ecosystem + '\nLocation: ' + location + '\nDevices: ' + (devices ? devices.length : 0));
                PatternDemo.toast(ecosystem + ' Family Created', 'success');
            })
            .catch(function(e) { PatternDemo.showResult('abstract-factory-result', 'Error: ' + e.message); });
    }
};
</script>
</div>
