<div class="pattern-card" id="pattern-facade" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸ¬</div>
        <div class="pattern-info">
            <h3>Cinema Mode (Scenes)</h3>
            <span class="pattern-badge badge-structural">Facade Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        One-click <strong>Scenes</strong> that orchestrate multiple devices seamlessly.
        The <strong>Facade Pattern</strong> provides a simplified interface (e.g., "activateMovieMode") to a complex subsystem (lighting, audio, tv, blinds).
    </p>

    <div class="pattern-demo">
        <h4>ğŸ® Scene Controller</h4>

        <div class="scene-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div class="scene-card" onclick="Facade.activate('morning')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
                <div style="font-size: 3.5em; margin-bottom: 15px;">ğŸŒ…</div>
                <div style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">Morning Rise</div>
                <div style="font-size: 0.85em; color: var(--text-muted);">Lights 50%, Blinds Open, Coffee On</div>
                <div class="overlay" style="position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,193,7,0.2), rgba(255,193,7,0)); opacity: 0; transition: all 0.3s; border: 1px solid var(--warning);"></div>
            </div>

            <div class="scene-card" onclick="Facade.activate('night')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
                <div style="font-size: 3.5em; margin-bottom: 15px;">ğŸŒ™</div>
                <div style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">Goodnight</div>
                <div style="font-size: 0.85em; color: var(--text-muted);">All Off, Doors Locked, Alarm Set</div>
                <div class="overlay" style="position: absolute; inset: 0; background: linear-gradient(135deg, rgba(100,100,255,0.2), rgba(100,100,255,0)); opacity: 0; transition: all 0.3s; border: 1px solid #6464ff;"></div>
            </div>

            <div class="scene-card" onclick="Facade.activate('movie')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
                <div style="font-size: 3.5em; margin-bottom: 15px;">ğŸ¬</div>
                <div style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">Movie Time</div>
                <div style="font-size: 0.85em; color: var(--text-muted);">Dims Lights, TV On, Sound Mode</div>
                <div class="overlay" style="position: absolute; inset: 0; background: linear-gradient(135deg, rgba(220,53,69,0.2), rgba(220,53,69,0)); opacity: 0; transition: all 0.3s; border: 1px solid var(--danger);"></div>
            </div>

            <div class="scene-card" onclick="Facade.activate('party')" style="padding: 25px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 16px; cursor: pointer; transition: all 0.3s; position: relative; overflow: hidden;">
                <div style="font-size: 3.5em; margin-bottom: 15px;">ğŸ‰</div>
                <div style="font-size: 1.2em; font-weight: 700; color: var(--text); margin-bottom: 5px;">Party Mode</div>
                <div style="font-size: 0.85em; color: var(--text-muted);">Colors Loop, Music Max, AC Cool</div>
                <div class="overlay" style="position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,0,255,0.2), rgba(255,0,255,0)); opacity: 0; transition: all 0.3s; border: 1px solid #ff00ff;"></div>
            </div>
        </div>

        <div class="behind-scenes" style="margin-top: 30px; padding: 25px; background: rgba(0,0,0,0.4); border-radius: 16px; border: 1px solid var(--glass-border); border-left: 4px solid var(--primary); box-shadow: inset 0 0 20px rgba(0,0,0,0.5);">
            <h5 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-family: 'Consolas', monospace; text-transform: uppercase; letter-spacing: 1px;">
                <span style="opacity: 0.7;">&gt;</span> Facade Internal Operations
            </h5>
            <div class="operations-list" id="facade-operations" style="font-family: 'Consolas', monospace; color: #a7b1c2; min-height: 100px;">
                <p class="placeholder" style="color: var(--text-muted); opacity: 0.5;">// Select a scene above to inspect subsystem calls...</p>
            </div>
        </div>

        <div class="pattern-explanation">
            <h5>ğŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Complex Subsystems:</strong> There are many classes (`Lighting`, `Sound`, `Security`, `Climate`).</li>
                <li><strong>Facade:</strong> A single class (`HomeTheaterFacade`) that knows which methods to call on which objects.</li>
                <li><strong>Client:</strong> Calls `facade.watchMovie()`. Simple!</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="facade-result"></div>
<script>
var Facade = {
    sceneOperations: {
        morning: [
            { device: 'ğŸ’¡ Lights', action: 'setBrightness(50)' },
            { device: 'ğŸªŸ Blinds', action: 'open()' },
            { device: 'â˜• CoffeeMaker', action: 'brew()' },
            { device: 'ğŸŒ¡ï¸ Thermostat', action: 'setTemp(22)' }
        ],
        night: [
            { device: 'ğŸ’¡ Lights', action: 'turnOffAll()' },
            { device: 'ğŸ”’ DoorLock', action: 'lock()' },
            { device: 'ğŸš¨ Alarm', action: 'armHome()' },
            { device: 'ğŸŒ¡ï¸ Thermostat', action: 'setEcoMode()' }
        ],
        movie: [
            { device: 'ğŸ’¡ Lights', action: 'dim(10)' },
            { device: 'ğŸ“º TV', action: 'turnOn()' },
            { device: 'ğŸ”Š SoundBar', action: 'setMode("Cinema")' },
            { device: 'ğŸ¿ Popcorn', action: 'prepare()' }
        ],
        party: [
            { device: 'ğŸ’¡ RGB Lights', action: 'startEffect("Rainbow")' },
            { device: 'ğŸ”Š Speakers', action: 'setVolume(85)' },
            { device: 'ğŸµ Playlist', action: 'play("Dance Mix")' },
            { device: 'â„ï¸ AC', action: 'turboCool()' }
        ]
    },
    activate: function(scene) {
        var ops = this.sceneOperations[scene] || [];
        var html = '';

        ops.forEach(function(op, i) {
            html += '<div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05);">' +
                        '<span style="color: var(--accent);">' + op.device + '</span>' +
                        '<span style="color: var(--success);">' + op.action + '</span>' +
                    '</div>';
        });

        document.getElementById('facade-operations').innerHTML = html;

        // Highlight card
        document.querySelectorAll('.scene-card').forEach(c => c.style.borderColor = 'var(--glass-border)');
        document.querySelectorAll('.scene-card .overlay').forEach(o => o.style.opacity = '0');

        var targetCard = document.querySelector('.scene-card[onclick*="' + scene + '"]');
        if(targetCard) {
            targetCard.style.borderColor = 'var(--primary)';
            targetCard.querySelector('.overlay').style.opacity = '1';
        }

        fetch('/api/patterns/facade/scene/' + scene, { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                PatternDemo.showResult('facade-result', 'ğŸ¬ Scene Activated: ' + scene.toUpperCase() + '\n' +
                    '--------------------------------\n' +
                    'Facade coordinated ' + ops.length + ' distinct subsystems.\n' +
                    'Complexity hidden from client code.');
                PatternDemo.toast(scene.toUpperCase() + ' Scene Active', 'success');
            });
    }
};
</script>
</div>
