<div class="pattern-card" id="pattern-bridge" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸŒ‰</div>
        <div class="pattern-info">
            <h3>Control Bridge</h3>
            <span class="pattern-badge badge-structural">Bridge Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Separate <strong>Abstraction</strong> (the remote control) from <strong>Implementation</strong> (the device logic). Mix any remote with any device without class explosion.
    </p>

    <div class="pattern-demo">
        <h4>ğŸ® Universal Connection</h4>

        <div class="pd-layout pd-layout--center pd-layout--gap-lg" style="margin-bottom:30px">
            <!-- Abstraction Side -->
            <div class="pd-panel pd-col pd-col--narrow">
                <h5 class="pd-panel-header pd-panel-header--bordered">ğŸ“± Abstraction (Remote)</h5>
                <div style="display:flex;flex-direction:column;gap:15px">
                    <button class="pd-list-btn active" onclick="Bridge.selectRemote(this,'basic')">
                        <span class="pd-list-icon">ğŸ“±</span>
                        <div><span class="pd-list-name">Basic Remote</span><span class="pd-list-desc">Simple interface, basic commands.</span></div>
                    </button>
                    <button class="pd-list-btn" onclick="Bridge.selectRemote(this,'advanced')">
                        <span class="pd-list-icon">ğŸ“²</span>
                        <div><span class="pd-list-name">Pro Remote</span><span class="pd-list-desc">Advanced macro & voice features.</span></div>
                    </button>
                </div>
            </div>

            <!-- Bridge Connector -->
            <div class="pd-bridge">
                <div class="pd-bridge-line"></div>
                <div class="pd-bridge-icon">ğŸŒ‰</div>
                <div class="pd-bridge-label">Bridge</div>
            </div>

            <!-- Implementation Side -->
            <div class="pd-panel pd-col pd-col--narrow">
                <h5 class="pd-panel-header pd-panel-header--warning pd-panel-header--bordered">ğŸ  Implementation (Device)</h5>
                <div style="display:flex;flex-direction:column;gap:15px">
                    <button class="pd-list-btn active" onclick="Bridge.selectDevice(this,'light')">
                        <span class="pd-sel-icon">ğŸ’¡</span>
                        <span class="pd-list-name">Smart Light</span>
                    </button>
                    <button class="pd-list-btn" onclick="Bridge.selectDevice(this,'tv')">
                        <span class="pd-sel-icon">ğŸ“º</span>
                        <span class="pd-list-name">Smart TV</span>
                    </button>
                    <button class="pd-list-btn" onclick="Bridge.selectDevice(this,'thermostat')">
                        <span class="pd-sel-icon">ğŸŒ¡ï¸</span>
                        <span class="pd-list-name">HVAC Unit</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="pd-panel" style="margin-bottom:25px">
            <h5 class="pd-small-heading">Available Operations via Bridge</h5>
            <div id="bridge-actions" class="pd-pill-row" style="justify-content:center"></div>
        </div>

        <div class="pattern-explanation">
            <h5>ğŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Decoupling:</strong> The <code>Remote</code> class doesn't inherit from <code>Device</code>. It HAS A <code>Device</code>.</li>
                <li><strong>Extensibility:</strong> You can add a new <code>SmartRemote</code> without modifying <code>TV</code> or <code>Light</code>.</li>
                <li><strong>Result:</strong> <code>Remote(Abstraction) â†’ Bridge â†’ Device(Implementation)</code>.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="bridge-result"></div>
<script>
var Bridge = {
    selectedRemote: 'basic',
    selectedDevice: 'light',
    selectRemote: function(btn, remote) {
        document.querySelectorAll('#pattern-bridge .pd-list-btn').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        this.selectedRemote = remote;
        this.updateActions();
    },
    selectDevice: function(btn, device) {
        document.querySelectorAll('#pattern-bridge .pd-col--narrow:last-child .pd-list-btn').forEach(function(b) { b.classList.remove('active'); });
        btn.classList.add('active');
        this.selectedDevice = device;
    },
    updateActions: function() {
        var actions = {
            basic: '<button class="pd-pill pd-pill--primary" onclick="Bridge.execute(\'on\')">âš¡ ON</button><button class="pd-pill pd-pill--primary" onclick="Bridge.execute(\'off\')">ğŸ”Œ OFF</button>',
            advanced: '<button class="pd-pill pd-pill--primary" onclick="Bridge.execute(\'on\')">âš¡ ON</button><button class="pd-pill pd-pill--primary" onclick="Bridge.execute(\'off\')">ğŸ”Œ OFF</button><button class="pd-pill pd-pill--warning" onclick="Bridge.execute(\'dim\')">ğŸ”‰ VOL -</button><button class="pd-pill pd-pill--warning" onclick="Bridge.execute(\'bright\')">ğŸ”Š VOL +</button>'
        };
        var html = actions[this.selectedRemote] || actions.basic;
        if (this.selectedDevice === 'light') html = html.replace('VOL -','DIM').replace('VOL +','BRIGHT');
        else if (this.selectedDevice === 'thermostat') html = html.replace('VOL -','COOL').replace('VOL +','HEAT');
        document.getElementById('bridge-actions').innerHTML = html;
    },
    execute: function(action) {
        PatternDemo.showResult('bridge-result', 'ğŸŒ‰ Bridge Signal:\n1. User â†’ ' + this.selectedRemote + ' (Abstraction)\n2. Delegates to Device Interface\n3. Bridge â†’ ' + this.selectedDevice + ' (Implementation)\n4. Execute: ' + action.toUpperCase());
        PatternDemo.toast('Command: ' + action.toUpperCase(), 'success');
        fetch('/api/patterns/bridge/control?remote=' + this.selectedRemote + '&device=' + this.selectedDevice + '&action=' + action, {method:'POST'});
    }
};
Bridge.updateActions();
</script>
</div>
