<div class="pattern-card active" id="pattern-singleton" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">üè†</div>
        <div class="pattern-info">
            <h3>Home Mode Controller</h3>
            <span class="pattern-badge badge-creational">Singleton Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        There is only <strong>ONE</strong> Home Controller instance. It acts as the single source of truth for your home's state. Changing mode here instantly propagates to all subsystems.
    </p>

    <div class="pattern-demo">
        <h4>üéÆ Control Center</h4>

        <div class="pd-selector pd-selector--lg" style="margin-bottom: 30px;">
            <button class="pd-sel-btn active" id="mode-normal" onclick="Singleton.setMode('NORMAL')">
                <span class="pd-sel-icon">üè°</span>
                <span class="pd-sel-label">Normal</span>
                <span class="pd-sel-desc">Standard</span>
            </button>
            <button class="pd-sel-btn" id="mode-away" onclick="Singleton.setMode('AWAY')">
                <span class="pd-sel-icon">üõ°Ô∏è</span>
                <span class="pd-sel-label">Away</span>
                <span class="pd-sel-desc">Armed</span>
            </button>
            <button class="pd-sel-btn" id="mode-night" onclick="Singleton.setMode('NIGHT')">
                <span class="pd-sel-icon">üåô</span>
                <span class="pd-sel-label">Night</span>
                <span class="pd-sel-desc">Quiet</span>
            </button>
            <button class="pd-sel-btn" id="mode-vacation" onclick="Singleton.setMode('VACATION')">
                <span class="pd-sel-icon">‚úàÔ∏è</span>
                <span class="pd-sel-label">Vacation</span>
                <span class="pd-sel-desc">Simulated</span>
            </button>
        </div>

        <div class="pd-status">
            <div class="pd-status-item">
                <span class="pd-status-label">Active Mode</span>
                <span class="pd-status-value pd-status-value--primary" id="singleton-current-mode">NORMAL</span>
            </div>
            <div class="pd-divider"></div>
            <div class="pd-status-item">
                <span class="pd-status-label">Active Devices</span>
                <span class="pd-status-value" id="singleton-active-devices">--</span>
            </div>
            <div class="pd-divider"></div>
            <div class="pd-status-item">
                <span class="pd-status-label">System Health</span>
                <span class="pd-status-value pd-status-value--success" id="singleton-system-status">Online</span>
            </div>
        </div>

        <script>
        var Singleton = {
            setMode: function(mode) {
                document.querySelectorAll('#pattern-singleton .pd-sel-btn').forEach(function(b) {
                    b.classList.remove('active');
                });
                var btn = document.getElementById('mode-' + mode.toLowerCase());
                if(btn) btn.classList.add('active');

                fetch('/api/mode/' + mode, { method: 'POST' })
                    .then(function(r) { return r.json(); })
                    .then(function(data) {
                        document.getElementById('singleton-current-mode').textContent = data.homeMode || mode;
                        document.getElementById('singleton-active-devices').textContent = data.activeDevices || 12;
                        PatternDemo.showResult('singleton-result',
                            'Singleton Controller Updated:\nCurrent Instance ID: ' + Math.random().toString(36).substr(2, 9).toUpperCase() + ' (Static)\nNew State: ' + mode + '\nBroadcasting to all smart devices...');
                        PatternDemo.toast('Home Mode set to ' + mode, 'success');
                    });
            }
        };
        </script>

        <div class="pattern-explanation">
            <h5>üí° How It Works</h5>
            <ul>
                <li>The <code>HomeController</code> class has a private constructor.</li>
                <li>Access is restricted to a static <code>getInstance()</code> method.</li>
                <li>This guarantees that no matter where you access the controller from (Web, App, Timer), you get the exact same object with the same state.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="singleton-result"></div>
</div>
