<div class="pattern-card" id="pattern-composite" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸ¢</div>
        <div class="pattern-info">
            <h3>Room & Device Groups</h3>
            <span class="pattern-badge badge-structural">Composite Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">Treat <strong>individual devices</strong> and <strong>groups of devices</strong> uniformly. Control an entire room, floor, or the whole house with a single command!</p>
    <div class="pattern-demo">
        <h4>ğŸ® Control Device Hierarchy</h4>
        <div class="hierarchy-tree">
            <div class="tree-node house" onclick="Composite.control('house','toggle')">
                <div class="node-icon">ğŸ </div>
                <div class="node-name">Whole House</div>
                <div class="node-count">12 devices</div>
            </div>
            <div class="tree-level">
                <div class="tree-node floor" onclick="Composite.control('floor-1','toggle')">
                    <div class="node-icon">ğŸ¢</div>
                    <div class="node-name">First Floor</div>
                    <div class="node-count">7 devices</div>
                </div>
                <div class="tree-sublevel">
                    <div class="tree-node room" onclick="Composite.control('living-room','toggle')">
                        <div class="node-icon">ğŸ›‹ï¸</div>
                        <div class="node-name">Living Room</div>
                        <div class="node-count">3 devices</div>
                        <div class="room-devices">
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('living-light','toggle')">ğŸ’¡ Light</span>
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('living-tv','toggle')">ğŸ“º TV</span>
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('living-speaker','toggle')">ğŸ”Š Speaker</span>
                        </div>
                    </div>
                    <div class="tree-node room" onclick="Composite.control('kitchen','toggle')">
                        <div class="node-icon">ğŸ³</div>
                        <div class="node-name">Kitchen</div>
                        <div class="node-count">2 devices</div>
                        <div class="room-devices">
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('kitchen-light','toggle')">ğŸ’¡ Light</span>
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('kitchen-sensor','toggle')">ğŸ“¡ Sensor</span>
                        </div>
                    </div>
                    <div class="tree-node room" onclick="Composite.control('bedroom','toggle')">
                        <div class="node-icon">ğŸ›ï¸</div>
                        <div class="node-name">Bedroom</div>
                        <div class="node-count">2 devices</div>
                        <div class="room-devices">
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('bed-light','toggle')">ğŸ’¡ Light</span>
                            <span class="device-chip" onclick="event.stopPropagation();Composite.control('bed-thermo','toggle')">ğŸŒ¡ï¸ Thermo</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="composite-actions">
            <h5>ğŸ¯ Quick Group Actions</h5>
            <div class="group-btns">
                <button class="group-btn" onclick="Composite.control('house','on')">ğŸ  All ON</button>
                <button class="group-btn" onclick="Composite.control('house','off')">ğŸ  All OFF</button>
                <button class="group-btn" onclick="Composite.control('living-room','on')">ğŸ›‹ï¸ Living ON</button>
                <button class="group-btn" onclick="Composite.control('bedroom','off')">ğŸ›ï¸ Bedroom OFF</button>
            </div>
        </div>
        <div class="pattern-explanation">
            <h5>ğŸ’¡ How Composite Works:</h5>
            <ul>
                <li><strong>Component</strong>: Common interface for all objects (turnOn, turnOff)</li>
                <li><strong>Leaf</strong>: Individual devices (Light, TV, Thermostat)</li>
                <li><strong>Composite</strong>: Groups (Room, Floor, House) containing children</li>
                <li>Operations propagate down the tree to all children</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="composite-result"></div>
</div>
<script>
var Composite = {
    control: function(target, action) {
        var names = {
            'house':'Whole House','floor-1':'First Floor','living-room':'Living Room',
            'kitchen':'Kitchen','bedroom':'Bedroom','living-light':'Living Light',
            'living-tv':'TV','living-speaker':'Speaker','kitchen-light':'Kitchen Light',
            'kitchen-sensor':'Sensor','bed-light':'Bed Light','bed-thermo':'Thermostat'
        };
        var counts = {
            'house':12,'floor-1':7,'living-room':3,'kitchen':2,'bedroom':2
        };
        var isGroup = counts[target] !== undefined;
        var affected = isGroup ? counts[target] : 1;
        fetch('/api/patterns/composite/control?target=' + target + '&action=' + action, {method:'POST'})
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var msg = (isGroup ? 'Group' : 'Device') + ': ' + names[target] + '\nAction: ' + action.toUpperCase() + '\nAffected devices: ' + affected;
                if (isGroup) msg += '\n\nThe Composite pattern propagated the command to all ' + affected + ' child devices.';
                PatternDemo.showResult('composite-result', msg + '\n\n' + JSON.stringify(data, null, 2));
                PatternDemo.toast(names[target] + ' ' + action, 'success');
            });
    }
};
</script>
<style>
.hierarchy-tree { padding: 20px; background: rgba(0,0,0,0.2); border-radius: 15px; margin-bottom: 20px; }
.tree-node { display: flex; align-items: center; gap: 12px; padding: 12px 18px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; margin-bottom: 10px; cursor: pointer; transition: all 0.3s; }
.tree-node:hover { background: rgba(0,210,255,0.1); border-color: rgba(0,210,255,0.4); }
.tree-node.house { border-color: #ffc107; background: rgba(255,193,7,0.1); }
.tree-node.floor { border-color: #28a745; background: rgba(40,167,69,0.1); }
.tree-node.room { flex-wrap: wrap; }
.node-icon { font-size: 1.8em; }
.node-name { font-weight: 600; flex: 1; }
.node-count { font-size: 0.8em; color: #888; padding: 3px 10px; background: rgba(0,0,0,0.2); border-radius: 10px; }
.tree-level { margin-left: 30px; padding-left: 20px; border-left: 2px dashed rgba(255,255,255,0.1); }
.tree-sublevel { margin-left: 30px; padding-left: 20px; border-left: 2px dashed rgba(255,255,255,0.1); }
.room-devices { width: 100%; display: flex; gap: 8px; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
.device-chip { padding: 5px 12px; background: rgba(0,210,255,0.15); border-radius: 15px; font-size: 0.8em; cursor: pointer; transition: all 0.3s; }
.device-chip:hover { background: rgba(0,210,255,0.3); }
.composite-actions { padding: 15px; background: rgba(0,210,255,0.05); border-radius: 12px; }
.composite-actions h5 { color: #888; margin-bottom: 12px; }
.group-btns { display: flex; flex-wrap: wrap; gap: 10px; }
.group-btn { padding: 10px 18px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; color: white; cursor: pointer; transition: all 0.3s; }
.group-btn:hover { background: rgba(0,210,255,0.2); border-color: #00d2ff; }
</style>
</div>
