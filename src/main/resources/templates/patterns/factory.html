<div class="pattern-card" id="pattern-factory" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">üè≠</div>
        <div class="pattern-info">
            <h3>Device Factory</h3>
            <span class="pattern-badge badge-creational">Factory Method</span>
        </div>
    </div>
    <p class="pattern-desc">
        Create devices without specifying their exact class. The <strong>Factory Method</strong> allows you to request a "Light" or "Thermostat", and the system figures out which concrete class to instantiate.
    </p>

    <div class="pattern-demo">
        <h4>üéÆ Device Assembly Line</h4>

        <div class="pd-panel">
            <div class="pd-form-group">
                <label class="pd-form-label">Select Device Type</label>
                <div class="pd-selector">
                    <button class="pd-sel-btn active" data-type="LIGHT" onclick="Factory.selectType(this, 'LIGHT')">
                        <span class="pd-sel-icon">üí°</span>
                        <span class="pd-sel-label">Smart Light</span>
                    </button>
                    <button class="pd-sel-btn" data-type="THERMOSTAT" onclick="Factory.selectType(this, 'THERMOSTAT')">
                        <span class="pd-sel-icon">üå°Ô∏è</span>
                        <span class="pd-sel-label">Thermostat</span>
                    </button>
                    <button class="pd-sel-btn" data-type="CAMERA" onclick="Factory.selectType(this, 'CAMERA')">
                        <span class="pd-sel-icon">üì∑</span>
                        <span class="pd-sel-label">Security Cam</span>
                    </button>
                    <button class="pd-sel-btn" data-type="LOCK" onclick="Factory.selectType(this, 'LOCK')">
                        <span class="pd-sel-icon">üîí</span>
                        <span class="pd-sel-label">Smart Lock</span>
                    </button>
                </div>
            </div>

            <div class="pd-form-row" style="margin-bottom: 25px;">
                <div>
                    <label class="pd-form-label pd-form-label--muted">Device Name</label>
                    <input type="text" id="factory-device-name" class="pd-input" placeholder="e.g., Kitchen Light" value="New Device">
                </div>
                <div>
                    <label class="pd-form-label pd-form-label--muted">Location</label>
                    <input type="text" id="factory-device-location" class="pd-input" placeholder="e.g., Living Room" value="Living Room">
                </div>
            </div>

            <button class="pd-btn-action" onclick="Factory.createDevice()">üè≠ Manufacture Device</button>

            <hr class="pd-divider-h">

            <h5 class="pd-small-heading">‚ö° Quick Templates</h5>
            <div class="pd-pill-row">
                <button class="pd-pill" onclick="Factory.quickCreate('LIGHT', 'Kitchen Light', 'Kitchen')">
                    <span class="pd-pill-icon">üí°</span> Kitchen Light
                </button>
                <button class="pd-pill" onclick="Factory.quickCreate('THERMOSTAT', 'Living Thermostat', 'Living Room')">
                    <span class="pd-pill-icon">üå°Ô∏è</span> Living Thermostat
                </button>
                <button class="pd-pill" onclick="Factory.quickCreate('CAMERA', 'Front Door Cam', 'Entrance')">
                    <span class="pd-pill-icon">üì∑</span> Front Door Cam
                </button>
            </div>
        </div>

        <div class="pattern-explanation">
            <h5>üí° Pattern Logic</h5>
            <ul>
                <li><strong>Client:</strong> Requests a device by Interface (Device) and Type (Enum).</li>
                <li><strong>Factory:</strong> Encapsulates <code>new SmartLight()</code> etc. inside <code>createDevice()</code>.</li>
                <li><strong>Result:</strong> Client gets a fully initialized object without coupling to concrete classes.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="factory-result"></div>
<script>
var Factory = {
    selectedType: 'LIGHT',
    selectType: function(btn, type) {
        document.querySelectorAll('#pattern-factory .pd-sel-btn').forEach(function(b) {
            b.classList.remove('active');
        });
        btn.classList.add('active');
        this.selectedType = type;
        var nameInput = document.getElementById('factory-device-name');
        if (nameInput.value === 'New Device' || nameInput.value.includes('Device')) {
            nameInput.value = 'New ' + type.charAt(0).toUpperCase() + type.slice(1).toLowerCase();
        }
    },
    createDevice: function() {
        var name = document.getElementById('factory-device-name').value;
        var location = document.getElementById('factory-device-location').value;
        this.quickCreate(this.selectedType, name, location);
    },
    quickCreate: function(type, name, location) {
        PatternDemo.showResult('factory-result', 'üè≠ Factory is manufacturing ' + type + '...');
        fetch('/api/patterns/factory/create?type=' + type + '&name=' + encodeURIComponent(name) + '&location=' + encodeURIComponent(location), { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                PatternDemo.showResult('factory-result',
                    '‚úÖ Device Manufactured Successfully!\n\nüì¶ Class: ' + type + 'Device\nüè∑Ô∏è Name: ' + (data.name || name) + '\nüìç Location: ' + (data.location || location) + '\nüÜî ID: ' + (data.id || 'DEV-' + Math.floor(Math.random()*10000)) + '\n\nThe Factory Method pattern encapsulated the object creation logic.');
                PatternDemo.toast('Factory created: ' + name, 'success');
            });
    }
};
</script>
</div>
