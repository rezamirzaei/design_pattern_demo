<div class="pattern-card" id="pattern-factory" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">üè≠</div>
        <div class="pattern-info">
            <h3>Device Factory</h3>
            <span class="pattern-badge badge-creational">Factory Method</span>
        </div>
    </div>
    <p class="pattern-desc">
        Create devices without specifying their exact class. The <strong>Factory Method</strong> allows you to request a "Light" or "Thermostat", and the system figures out which concrete class (e.g., <code>SmartLight</code>, <code>NestThermostat</code>) to instantiate.
    </p>

    <div class="pattern-demo">
        <h4>üéÆ Device Assembly Line</h4>

        <div class="device-creator" style="background: var(--darker); padding: 30px; border-radius: 16px; border: 1px solid var(--glass-border); box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
            <div class="creator-form">
                <div class="form-group" style="margin-bottom: 25px;">
                    <label style="color: var(--primary); margin-bottom: 15px; display: block; font-weight: 700; text-transform: uppercase; font-size: 0.85em; letter-spacing: 1px;">Select Device Type</label>
                    <div class="device-type-selector" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 15px;">
                        <button class="type-btn active" data-type="LIGHT" onclick="Factory.selectType(this, 'LIGHT')" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border-radius: 14px; background: rgba(0, 210, 255, 0.15); border: 1px solid var(--primary); color: white; cursor: pointer; transition: all 0.2s; box-shadow: 0 5px 15px rgba(0, 210, 255, 0.2);">
                            <span class="type-icon" style="font-size: 2.2em; margin-bottom: 8px;">üí°</span>
                            <span style="font-size: 0.9em; font-weight: 600;">Smart Light</span>
                        </button>
                        <button class="type-btn" data-type="THERMOSTAT" onclick="Factory.selectType(this, 'THERMOSTAT')" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border-radius: 14px; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-muted); cursor: pointer; transition: all 0.2s;">
                            <span class="type-icon" style="font-size: 2.2em; margin-bottom: 8px;">üå°Ô∏è</span>
                            <span style="font-size: 0.9em; font-weight: 600;">Thermostat</span>
                        </button>
                        <button class="type-btn" data-type="CAMERA" onclick="Factory.selectType(this, 'CAMERA')" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border-radius: 14px; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-muted); cursor: pointer; transition: all 0.2s;">
                            <span class="type-icon" style="font-size: 2.2em; margin-bottom: 8px;">üì∑</span>
                            <span style="font-size: 0.9em; font-weight: 600;">Security Cam</span>
                        </button>
                        <button class="type-btn" data-type="LOCK" onclick="Factory.selectType(this, 'LOCK')" style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; border-radius: 14px; background: var(--glass-bg); border: 1px solid var(--glass-border); color: var(--text-muted); cursor: pointer; transition: all 0.2s;">
                            <span class="type-icon" style="font-size: 2.2em; margin-bottom: 8px;">üîí</span>
                            <span style="font-size: 0.9em; font-weight: 600;">Smart Lock</span>
                        </button>
                    </div>
                </div>

                <div class="form-row" style="display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 8px; display: block;">Device Name</label>
                        <input type="text" id="factory-device-name" class="form-input" placeholder="e.g., Kitchen Light" value="New Device" style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: var(--text);">
                    </div>
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label style="color: var(--text-muted); font-size: 0.9em; margin-bottom: 8px; display: block;">Location</label>
                        <input type="text" id="factory-device-location" class="form-input" placeholder="e.g., Living Room" value="Living Room" style="width: 100%; padding: 12px 15px; border-radius: 10px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: var(--text);">
                    </div>
                </div>

                <button class="btn-primary" onclick="Factory.createDevice()" style="width: 100%; padding: 15px; border-radius: 12px; font-weight: 700; font-size: 1.1em; background: linear-gradient(135deg, var(--primary), var(--secondary)); border: none; cursor: pointer; box-shadow: 0 0 20px rgba(0, 210, 255, 0.3); transition: transform 0.2s;">
                    üè≠ Manufacture Device
                </button>
            </div>

            <div class="quick-create" style="margin-top: 30px; padding-top: 25px; border-top: 1px dashed var(--glass-border);">
                <h5 style="margin-bottom: 15px; color: var(--text-muted); font-size: 0.9em; text-transform: uppercase;">‚ö° Quick Templates</h5>
                <div style="display: flex; flex-wrap: wrap; gap: 12px;">
                    <button class="action-btn" style="padding: 10px 18px; border-radius: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s;" onclick="Factory.quickCreate('LIGHT', 'Kitchen Light', 'Kitchen')">
                        <span style="font-size: 1.2em;">üí°</span> Kitchen Light
                    </button>
                    <button class="action-btn" style="padding: 10px 18px; border-radius: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s;" onclick="Factory.quickCreate('THERMOSTAT', 'Living Thermostat', 'Living Room')">
                        <span style="font-size: 1.2em;">üå°Ô∏è</span> Living Thermostat
                    </button>
                    <button class="action-btn" style="padding: 10px 18px; border-radius: 20px; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border); color: var(--text); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.2s;" onclick="Factory.quickCreate('CAMERA', 'Front Door Cam', 'Entrance')">
                        <span style="font-size: 1.2em;">üì∑</span> Front Door Cam
                    </button>
                </div>
            </div>
        </div>

        <div class="pattern-explanation">
            <h5>üí° Pattern Logic</h5>
            <ul>
                <li><strong>Client:</strong> Requests a device by Interface (Device) and Type (Enum).</li>
                <li><strong>Factory:</strong> Encapsulates `new SmartLight()` etc. inside `createDevice()`.</li>
                <li><strong>Result:</strong> Client gets a fully initialized object without coupling to concrete classes.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="factory-result"></div>
</div>
<script>
var Factory = {
    selectedType: 'LIGHT',
    selectType: function(btn, type) {
        document.querySelectorAll('#pattern-factory .type-btn').forEach(function(b) {
            b.classList.remove('active');
            b.style.background = 'var(--glass-bg)';
            b.style.borderColor = 'var(--glass-border)';
            b.style.color = 'var(--text-muted)';
        });
        btn.classList.add('active');
        btn.style.background = 'rgba(0, 210, 255, 0.15)';
        btn.style.borderColor = 'var(--primary)';
        btn.style.color = 'white';

        this.selectedType = type;

        // Update default name based on type
        var nameInput = document.getElementById('factory-device-name');
        if (nameInput.value === 'New Device' || nameInput.value.includes('Device')) {
            var icon = btn.querySelector('.type-icon').textContent;
            nameInput.value = 'New ' + type.charAt(0).toUpperCase() + type.slice(1).toLowerCase();
        }
    },
    createDevice: function() {
        var name = document.getElementById('factory-device-name').value;
        var location = document.getElementById('factory-device-location').value;
        this.quickCreate(this.selectedType, name, location);
    },
    quickCreate: function(type, name, location) {
        // Show loading state
        PatternDemo.showResult('factory-result', 'üè≠ Factory is manufacturing ' + type + '...');

        fetch('/api/patterns/factory/create?type=' + type + '&name=' + encodeURIComponent(name) + '&location=' + encodeURIComponent(location), { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var output = '‚úÖ Device Manufactured Successfully!\n\n' +
                             'üì¶ Class: ' + (type.charAt(0) + type.slice(1).toLowerCase()) + 'Device\n' +
                             'üè∑Ô∏è Name: ' + (data.name || name) + '\n' +
                             'üìç Location: ' + (data.location || location) + '\n' +
                             'üÜî ID: ' + (data.id || 'DEV-' + Math.floor(Math.random()*10000)) + '\n\n' +
                             'The Factory Method pattern encapsulated the object creation logic,\n' +
                             'keeping your client code clean and decoupled.';

                PatternDemo.showResult('factory-result', output);
                PatternDemo.toast('Factory created: ' + name, 'success');
            });
    }
};
</script>
</div>
