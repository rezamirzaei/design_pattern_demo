<div class="pattern-card" id="pattern-proxy" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸ›¡ï¸</div>
        <div class="pattern-info">
            <h3>Remote Device Access</h3>
            <span class="pattern-badge badge-structural">Proxy Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Access remote devices safely. The <strong>Proxy Pattern</strong> creates an intermediary wrapper that handles connection details, security checks, and lazy loading, making remote devices behave like local ones.
    </p>

    <div class="pattern-demo">
        <h4>ğŸ® Remote Connection Manager</h4>

        <div class="proxy-workspace" style="display: flex; flex-direction: column; gap: 25px;">
            <!-- Connection Panel -->
            <div class="connection-panel" style="padding: 25px; background: var(--darker); border-radius: 16px; border: 1px solid var(--glass-border); box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <div style="margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between;">
                    <h5 style="color: var(--primary); margin: 0; text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px; display: flex; align-items: center; gap: 8px;">
                        <span style="background: rgba(0, 210, 255, 0.2); padding: 5px; border-radius: 4px;">ğŸŒ</span> New Secure Connection
                    </h5>
                    <div style="font-family: monospace; color: var(--success); font-size: 0.8em;">â— SYSTEM READY</div>
                </div>

                <div class="connection-form" style="display: grid; grid-template-columns: 2fr 1.5fr 0.8fr auto; gap: 15px; align-items: end;">
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.8em; text-transform: uppercase; font-weight: 600;">Target Device</label>
                        <input type="text" id="proxy-device-name" class="form-input" placeholder="e.g., Garage Camera" value="Garage Camera" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text); font-family: 'Consolas', monospace;">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.8em; text-transform: uppercase; font-weight: 600;">IP Address</label>
                        <input type="text" id="proxy-ip-address" class="form-input" placeholder="192.168.1.x" value="192.168.1.50" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--warning); font-family: 'Consolas', monospace;">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.8em; text-transform: uppercase; font-weight: 600;">Port</label>
                        <input type="text" id="proxy-port" class="form-input" placeholder="8080" value="554" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); border-radius: 8px; color: var(--text); font-family: 'Consolas', monospace;">
                    </div>
                    <button class="btn-primary" onclick="Proxy.connect()" style="height: 46px; padding: 0 25px; background: var(--primary); border: none; border-radius: 8px; font-weight: 700; color: #000; cursor: pointer; transition: all 0.2s; box-shadow: 0 0 15px rgba(0, 210, 255, 0.3);">
                        ğŸ”— CONNECT
                    </button>
                </div>
            </div>

            <!-- Quick Connect -->
            <div class="presets-panel">
                <h5 style="color: var(--text-muted); margin-bottom: 15px; font-size: 0.85em; text-transform: uppercase; letter-spacing: 1px;">âš¡ Saved Profiles</h5>
                <div class="preset-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 15px;">
                    <button class="preset-btn" onclick="Proxy.quickConnect('Backyard Cam', '192.168.1.51', '554')" style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.2s; position: relative; overflow: hidden;">
                        <span class="preset-icon" style="font-size: 1.8em; background: rgba(255,255,255,0.05); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 10px;">ğŸ“·</span>
                        <div class="preset-info" style="flex: 1;">
                            <span class="preset-name" style="font-weight: 600; display: block; font-size: 1.05em; margin-bottom: 3px;">Backyard Cam</span>
                            <span class="preset-ip" style="font-size: 0.8em; color: var(--text-muted); font-family: 'Consolas', monospace; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">192.168.1.51:554</span>
                        </div>
                        <span class="preset-status" id="status-backyard" style="font-size: 2em; color: var(--glass-border); line-height: 0;">â€¢</span>
                    </button>

                    <button class="preset-btn" onclick="Proxy.quickConnect('Pool Pump', '192.168.1.53', '80')" style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.2s; position: relative; overflow: hidden;">
                        <span class="preset-icon" style="font-size: 1.8em; background: rgba(255,255,255,0.05); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 10px;">ğŸŠ</span>
                        <div class="preset-info" style="flex: 1;">
                            <span class="preset-name" style="font-weight: 600; display: block; font-size: 1.05em; margin-bottom: 3px;">Pool Pump</span>
                            <span class="preset-ip" style="font-size: 0.8em; color: var(--text-muted); font-family: 'Consolas', monospace; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">192.168.1.53:80</span>
                        </div>
                        <span class="preset-status" id="status-pool" style="font-size: 2em; color: var(--glass-border); line-height: 0;">â€¢</span>
                    </button>

                    <button class="preset-btn" onclick="Proxy.quickConnect('Garden Sensor', '192.168.1.52', '8080')" style="display: flex; align-items: center; gap: 15px; padding: 18px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.2s; position: relative; overflow: hidden;">
                        <span class="preset-icon" style="font-size: 1.8em; background: rgba(255,255,255,0.05); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 10px;">ğŸŒ±</span>
                        <div class="preset-info" style="flex: 1;">
                            <span class="preset-name" style="font-weight: 600; display: block; font-size: 1.05em; margin-bottom: 3px;">Garden Sensor</span>
                            <span class="preset-ip" style="font-size: 0.8em; color: var(--text-muted); font-family: 'Consolas', monospace; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">192.168.1.52:8080</span>
                        </div>
                        <span class="preset-status" id="status-garden" style="font-size: 2em; color: var(--glass-border); line-height: 0;">â€¢</span>
                    </button>
                </div>
            </div>

            <!-- Features Demo -->
            <div class="proxy-features" style="padding: 25px; background: rgba(0, 210, 255, 0.03); border-radius: 16px; border: 1px dashed rgba(0, 210, 255, 0.3); margin-top: 10px;">
                <h5 style="color: var(--primary); margin-bottom: 25px; text-align: center; font-size: 0.9em; text-transform: uppercase; letter-spacing: 2px;">ğŸ›¡ï¸ Active Security Interceptor</h5>
                <div class="feature-demo-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                    <div class="feature-demo-item" style="padding: 20px; background: var(--darker); border-radius: 12px; text-align: center; border: 1px solid var(--glass-border); transition: transform 0.3s;">
                        <span style="font-size: 2.5em; display: block; margin-bottom: 15px;">â³</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Lazy Load</span>
                        <p style="font-size: 0.85em; color: var(--text-muted); margin: 0; line-height: 1.4;">Only authenticates when you actually request data.</p>
                    </div>
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">ğŸ”</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Secure</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Identity verification</p>
                    </div>
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">ğŸ“¦</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Caching</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Local data storage</p>
                    </div>
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">ğŸ“Š</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Logging</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Access audit trail</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="pattern-explanation" style="margin-top: 25px;">
            <h5>ğŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Subject Interface:</strong> Common to both RealDevice and Proxy.</li>
                <li><strong>Real Subject:</strong> The actual heavy/remote object (`RemoteCamera`).</li>
                <li><strong>Proxy:</strong> Controls access to the real subject. It can check permissions or lazy-load the connection.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="proxy-result"></div>
<script>
var Proxy = {
    connect: function() {
        var name = document.getElementById('proxy-device-name').value;
        var ip = document.getElementById('proxy-ip-address').value;
        var port = document.getElementById('proxy-port').value;
        this.quickConnect(name, ip, port);
    },
    quickConnect: function(name, ip, port) {
        var address = ip + ':' + port;

        // Show loading state
        PatternDemo.showResult('proxy-result', 'ğŸ›¡ï¸ Proxy Intercepting...\n' +
            '> Request: Connect to ' + name + '\n' +
            '> Checking Permissions... OK\n' +
            '> Checking Cache... MISS\n' +
            '> Establishing Tunnel to ' + address + '...');

        // Reset status icons
        document.querySelectorAll('.preset-status').forEach(el => el.style.color = 'var(--text-muted)');
        var statusId = 'status-' + name.toLowerCase().split(' ')[0];
        var statusEl = document.getElementById(statusId);
        if (statusEl) statusEl.style.color = 'var(--warning)';

        var url = '/api/patterns/proxy/remote?name=' + encodeURIComponent(name) + '&address=' + encodeURIComponent(address);
        fetch(url, { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (statusEl) statusEl.style.color = 'var(--success)';

                var msg = 'ğŸ”— Secure Connection Established\n' +
                          '------------------------------\n' +
                          'Target: ' + name + '\n' +
                          'Endpoint: ' + address + '\n' +
                          'Latency: 24ms\n\n' +
                          'Proxy Services Active:\n' +
                          ' [x] Access Control\n [x] Read Caching\n [x] Activity Logging';

                PatternDemo.showResult('proxy-result', msg);
                PatternDemo.toast('Connected: ' + name, 'success');
            });
    }
};
</script>
</div>
