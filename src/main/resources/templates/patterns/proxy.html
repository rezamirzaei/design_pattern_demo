<div class="pattern-card" id="pattern-proxy" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">üõ°Ô∏è</div>
        <div class="pattern-info">
            <h3>Remote Device Access</h3>
            <span class="pattern-badge badge-structural">Proxy Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Access remote devices through a <strong>proxy</strong> that handles connection details, caching,
        and access control. The proxy acts as a stand-in for the real device.
    </p>
    <div class="pattern-demo">
        <h4>üéÆ Connect to Remote Devices via Proxy</h4>
        <div class="proxy-workspace">
            <!-- Remote Device Connection -->
            <div class="connection-panel">
                <h5>üåê Add Remote Device Connection</h5>
                <div class="connection-form">
                    <div class="form-group">
                        <label>Device Name</label>
                        <input type="text" id="proxy-device-name" class="form-input" placeholder="e.g., Garage Camera" value="Remote Camera">
                    </div>
                    <div class="form-group">
                        <label>IP Address</label>
                        <input type="text" id="proxy-ip-address" class="form-input" placeholder="e.g., 192.168.1.100" value="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label>Port</label>
                        <input type="text" id="proxy-port" class="form-input" placeholder="e.g., 8080" value="8080">
                    </div>
                    <button class="btn-connect" onclick="Proxy.connect()">
                        <span class="btn-icon">üîó</span>
                        Create Proxy Connection
                    </button>
                </div>
            </div>
            <!-- Quick Connect Presets -->
            <div class="presets-panel">
                <h5>‚ö° Quick Connect to Common Devices</h5>
                <div class="preset-grid">
                    <button class="preset-btn" onclick="Proxy.quickConnect('Garage Camera', '192.168.1.50', '554')">
                        <span class="preset-icon">üì∑</span>
                        <span class="preset-info">
                            <span class="preset-name">Garage Camera</span>
                            <span class="preset-ip">192.168.1.50:554</span>
                        </span>
                        <span class="preset-status" id="status-garage">‚óè</span>
                    </button>
                    <button class="preset-btn" onclick="Proxy.quickConnect('Doorbell Camera', '192.168.1.51', '554')">
                        <span class="preset-icon">üö™</span>
                        <span class="preset-info">
                            <span class="preset-name">Doorbell Camera</span>
                            <span class="preset-ip">192.168.1.51:554</span>
                        </span>
                        <span class="preset-status" id="status-doorbell">‚óè</span>
                    </button>
                    <button class="preset-btn" onclick="Proxy.quickConnect('Garden Sensor', '192.168.1.52', '80')">
                        <span class="preset-icon">üå±</span>
                        <span class="preset-info">
                            <span class="preset-name">Garden Sensor</span>
                            <span class="preset-ip">192.168.1.52:80</span>
                        </span>
                        <span class="preset-status" id="status-garden">‚óè</span>
                    </button>
                    <button class="preset-btn" onclick="Proxy.quickConnect('Pool Thermostat', '192.168.1.53', '80')">
                        <span class="preset-icon">üèä</span>
                        <span class="preset-info">
                            <span class="preset-name">Pool Thermostat</span>
                            <span class="preset-ip">192.168.1.53:80</span>
                        </span>
                        <span class="preset-status" id="status-pool">‚óè</span>
                    </button>
                </div>
            </div>
            <!-- Proxy Features Demonstration -->
            <div class="proxy-features">
                <h5>üõ°Ô∏è Proxy Features in Action</h5>
                <div class="feature-demo-grid">
                    <div class="feature-demo-item">
                        <span class="feature-demo-icon">‚è≥</span>
                        <span class="feature-demo-title">Lazy Loading</span>
                        <p>Connection is only established when first needed</p>
                    </div>
                    <div class="feature-demo-item">
                        <span class="feature-demo-icon">üîê</span>
                        <span class="feature-demo-title">Access Control</span>
                        <p>Proxy validates permissions before allowing access</p>
                    </div>
                    <div class="feature-demo-item">
                        <span class="feature-demo-icon">üì¶</span>
                        <span class="feature-demo-title">Caching</span>
                        <p>Proxy caches device state to reduce network calls</p>
                    </div>
                    <div class="feature-demo-item">
                        <span class="feature-demo-icon">üìä</span>
                        <span class="feature-demo-title">Logging</span>
                        <p>All remote operations are logged for debugging</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="pattern-explanation">
            <h5>üí° How Proxy Works Here:</h5>
            <ul>
                <li><strong>Virtual Proxy</strong>: Delays creating expensive remote connections until needed</li>
                <li><strong>Protection Proxy</strong>: Controls access to sensitive devices</li>
                <li><strong>Remote Proxy</strong>: Provides local representation of remote device</li>
                <li><strong>Caching Proxy</strong>: Stores results to avoid repeated network calls</li>
                <li>Client code doesn't know if it's talking to proxy or real device!</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="proxy-result"></div>
</div>
<script>
var Proxy = {
    connect: function() {
        var name = document.getElementById('proxy-device-name').value;
        var ip = document.getElementById('proxy-ip-address').value;
        var port = document.getElementById('proxy-port').value;
        this.quickConnect(name, ip, port);
    },
    quickConnect: function(name, ip, port) {
        var address = ip + ':' + port;
        var url = '/api/patterns/proxy/remote?name=' + encodeURIComponent(name) + '&address=' + encodeURIComponent(address);
        fetch(url, { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var msg = 'üîó Proxy Connection Established!\n\n';
                msg += 'Device: ' + name + '\n';
                msg += 'Address: ' + address + '\n\n';
                msg += 'Proxy Features Active:\n';
                msg += '  ‚úì Lazy Loading - Connection deferred until first use\n';
                msg += '  ‚úì Access Control - Permission check before operations\n';
                msg += '  ‚úì State Caching - Reduces network round-trips\n';
                msg += '  ‚úì Operation Logging - All calls recorded\n\n';
                msg += 'The proxy now acts as a local stand-in for the remote device.\n';
                msg += 'All operations go through the proxy transparently.';
                PatternDemo.showResult('proxy-result', msg);
                PatternDemo.toast('Proxy connected: ' + name, 'success');
                // Update status indicator if exists
                var statusId = 'status-' + name.toLowerCase().split(' ')[0];
                var statusEl = document.getElementById(statusId);
                if (statusEl) {
                    statusEl.style.color = '#00ff88';
                    statusEl.textContent = '‚óè';
                }
            });
    }
};
</script>
<style>
.proxy-workspace { display: flex; flex-direction: column; gap: 25px; }
.connection-panel h5, .presets-panel h5, .proxy-features h5 { color: #00d2ff; margin-bottom: 12px; font-size: 0.95em; }
.connection-form { display: grid; grid-template-columns: repeat(3, 1fr) auto; gap: 15px; align-items: end; }
.connection-form .form-group { margin: 0; }
.connection-form label { display: block; margin-bottom: 5px; color: #888; font-size: 0.85em; }
.btn-connect { padding: 10px 20px; background: linear-gradient(90deg, #00d2ff, #3a7bd5); border: none; border-radius: 8px; color: white; cursor: pointer; display: flex; align-items: center; gap: 8px; white-space: nowrap; height: 42px; }
.btn-connect:hover { transform: scale(1.02); }
.preset-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
.preset-btn { display: flex; align-items: center; gap: 12px; padding: 14px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; cursor: pointer; transition: all 0.3s; text-align: left; }
.preset-btn:hover { background: rgba(0,210,255,0.1); border-color: rgba(0,210,255,0.4); transform: translateX(5px); }
.preset-icon { font-size: 1.8em; }
.preset-info { display: flex; flex-direction: column; flex: 1; }
.preset-name { font-weight: 500; }
.preset-ip { font-size: 0.8em; color: #888; font-family: monospace; }
.preset-status { font-size: 1.2em; color: #666; }
.feature-demo-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
.feature-demo-item { padding: 15px; background: rgba(255,255,255,0.03); border-radius: 10px; text-align: center; }
.feature-demo-icon { font-size: 1.8em; display: block; margin-bottom: 8px; }
.feature-demo-title { display: block; color: #00d2ff; font-weight: 500; margin-bottom: 5px; }
.feature-demo-item p { font-size: 0.8em; color: #888; margin: 0; }
@media (max-width: 900px) {
    .connection-form { grid-template-columns: 1fr; }
    .preset-grid { grid-template-columns: 1fr; }
    .feature-demo-grid { grid-template-columns: repeat(2, 1fr); }
}
</style>
