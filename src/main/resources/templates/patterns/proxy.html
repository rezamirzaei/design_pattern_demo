<div class="pattern-card" id="pattern-proxy" th:fragment="content">
    <div class="pattern-header">
        <div class="pattern-icon">ğŸ›¡ï¸</div>
        <div class="pattern-info">
            <h3>Remote Device Access</h3>
            <span class="pattern-badge badge-structural">Proxy Pattern</span>
        </div>
    </div>
    <p class="pattern-desc">
        Access remote devices safely. The <strong>Proxy Pattern</strong> creates an intermediary wrapper that handles connection details, security checks, and lazy loading, making remote devices behave like local ones.
    </p>

    <div class="pattern-demo">
        <h4>ğŸ® Remote Connection Manager</h4>

        <div class="proxy-workspace" style="display: flex; flex-direction: column; gap: 20px;">
            <!-- Connection Panel -->
            <div class="connection-panel" style="padding: 20px; background: rgba(0,0,0,0.2); border-radius: 15px; border: 1px solid var(--glass-border);">
                <h5 style="color: var(--primary); margin-bottom: 15px; text-transform: uppercase; font-size: 0.9em;">ğŸŒ New Connection</h5>
                <div class="connection-form" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; align-items: end;">
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 0.85em;">Device Name</label>
                        <input type="text" id="proxy-device-name" class="form-input" placeholder="e.g., Garage Camera" value="Garage Camera">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 0.85em;">IP Address</label>
                        <input type="text" id="proxy-ip-address" class="form-input" placeholder="192.168.1.x" value="192.168.1.50">
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 0.85em;">Port</label>
                        <input type="text" id="proxy-port" class="form-input" placeholder="8080" value="554">
                    </div>
                    <button class="btn-primary" onclick="Proxy.connect()" style="height: 46px; margin-top: 0;">
                        <span>ğŸ”— Connect</span>
                    </button>
                </div>
            </div>

            <!-- Quick Connect -->
            <div class="presets-panel">
                <h5 style="color: var(--text-muted); margin-bottom: 12px; font-size: 0.9em;">âš¡ Quick Presets</h5>
                <div class="preset-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px;">
                    <button class="preset-btn" onclick="Proxy.quickConnect('Backyard Cam', '192.168.1.51', '554')" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s;">
                        <span class="preset-icon" style="font-size: 1.5em; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">ğŸ“·</span>
                        <div class="preset-info" style="flex: 1;">
                            <span class="preset-name" style="font-weight: 600; display: block;">Backyard Cam</span>
                            <span class="preset-ip" style="font-size: 0.8em; color: var(--text-muted); font-family: monospace;">192.168.1.51:554</span>
                        </div>
                        <span class="preset-status" id="status-backyard" style="font-size: 1.5em; color: var(--text-muted);">â—</span>
                    </button>

                    <button class="preset-btn" onclick="Proxy.quickConnect('Pool Pump', '192.168.1.53', '80')" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s;">
                        <span class="preset-icon" style="font-size: 1.5em; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">ğŸŠ</span>
                        <div class="preset-info" style="flex: 1;">
                            <span class="preset-name" style="font-weight: 600; display: block;">Pool Pump</span>
                            <span class="preset-ip" style="font-size: 0.8em; color: var(--text-muted); font-family: monospace;">192.168.1.53:80</span>
                        </div>
                        <span class="preset-status" id="status-pool" style="font-size: 1.5em; color: var(--text-muted);">â—</span>
                    </button>

                    <button class="preset-btn" onclick="Proxy.quickConnect('Garden Sensor', '192.168.1.52', '8080')" style="display: flex; align-items: center; gap: 12px; padding: 15px; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 12px; color: var(--text); cursor: pointer; text-align: left; transition: all 0.3s;">
                        <span class="preset-icon" style="font-size: 1.5em; background: rgba(255,255,255,0.05); padding: 8px; border-radius: 8px;">ğŸŒ±</span>
                        <div class="preset-info" style="flex: 1;">
                            <span class="preset-name" style="font-weight: 600; display: block;">Garden Sensor</span>
                            <span class="preset-ip" style="font-size: 0.8em; color: var(--text-muted); font-family: monospace;">192.168.1.52:8080</span>
                        </div>
                        <span class="preset-status" id="status-garden" style="font-size: 1.5em; color: var(--text-muted);">â—</span>
                    </button>
                </div>
            </div>

            <!-- Features Demo -->
            <div class="proxy-features" style="padding: 20px; background: rgba(0, 210, 255, 0.05); border-radius: 15px; border: 1px dashed var(--primary); margin-top: 10px;">
                <h5 style="color: var(--primary); margin-bottom: 20px; text-align: center;">ğŸ›¡ï¸ Active Security Layer</h5>
                <div class="feature-demo-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">â³</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Lazy Load</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Connects on demand</p>
                    </div>
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">ğŸ”</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Secure</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Identity verification</p>
                    </div>
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">ğŸ“¦</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Caching</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Local data storage</p>
                    </div>
                    <div class="feature-demo-item" style="padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; text-align: center;">
                        <span style="font-size: 2em; display: block; margin-bottom: 10px;">ğŸ“Š</span>
                        <span style="display: block; font-weight: 600; color: var(--text); margin-bottom: 5px;">Logging</span>
                        <p style="font-size: 0.8em; color: var(--text-muted); margin: 0;">Access audit trail</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="pattern-explanation" style="margin-top: 25px;">
            <h5>ğŸ’¡ Pattern Logic</h5>
            <ul>
                <li><strong>Subject Interface:</strong> Common to both RealDevice and Proxy.</li>
                <li><strong>Real Subject:</strong> The actual heavy/remote object (`RemoteCamera`).</li>
                <li><strong>Proxy:</strong> Controls access to the real subject. It can check permissions or lazy-load the connection.</li>
            </ul>
        </div>
    </div>
    <div class="result-area" id="proxy-result"></div>
</div>
<script>
var Proxy = {
    connect: function() {
        var name = document.getElementById('proxy-device-name').value;
        var ip = document.getElementById('proxy-ip-address').value;
        var port = document.getElementById('proxy-port').value;
        this.quickConnect(name, ip, port);
    },
    quickConnect: function(name, ip, port) {
        var address = ip + ':' + port;

        // Show loading state
        PatternDemo.showResult('proxy-result', 'ğŸ›¡ï¸ Proxy Intercepting...\n' +
            '> Request: Connect to ' + name + '\n' +
            '> Checking Permissions... OK\n' +
            '> Checking Cache... MISS\n' +
            '> Establishing Tunnel to ' + address + '...');

        // Reset status icons
        document.querySelectorAll('.preset-status').forEach(el => el.style.color = 'var(--text-muted)');
        var statusId = 'status-' + name.toLowerCase().split(' ')[0];
        var statusEl = document.getElementById(statusId);
        if (statusEl) statusEl.style.color = 'var(--warning)';

        var url = '/api/patterns/proxy/remote?name=' + encodeURIComponent(name) + '&address=' + encodeURIComponent(address);
        fetch(url, { method: 'POST' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (statusEl) statusEl.style.color = 'var(--success)';

                var msg = 'ğŸ”— Secure Connection Established\n' +
                          '------------------------------\n' +
                          'Target: ' + name + '\n' +
                          'Endpoint: ' + address + '\n' +
                          'Latency: 24ms\n\n' +
                          'Proxy Services Active:\n' +
                          ' [x] Access Control\n [x] Read Caching\n [x] Activity Logging';

                PatternDemo.showResult('proxy-result', msg);
                PatternDemo.toast('Connected: ' + name, 'success');
            });
    }
};
</script>
