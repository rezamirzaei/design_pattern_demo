<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home - Devices</title>
    <link rel="icon" type="image/svg+xml" th:href="@{/favicon.svg}">
    <link rel="stylesheet" th:href="@{/css/patterns-pro.css}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js" crossorigin="anonymous"></script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-brand">ğŸ  SmartHome OS</div>
        <button class="nav-hamburger" onclick="document.querySelector('.main-links').classList.toggle('open')" aria-label="Menu">â˜°</button>
        <div class="main-links">
            <a href="/" class="nav-link">Dashboard</a>
            <a href="/ui/devices" class="nav-link active">Devices</a>
            <a href="/ui/rooms" class="nav-link">Rooms</a>
            <a href="/ui/scenes" class="nav-link">Scenes</a>
            <a href="/ui/rules" class="nav-link">Rules</a>
            <a href="/ui/patterns" class="nav-link">Patterns</a>
        </div>
    </nav>

<div class="toast-container" id="toastContainer"></div>
<div class="container">
    <header>
        <h1>ğŸ“± Devices</h1>
        <p class="subtitle">Manage your smart home devices â€” create, control, and monitor</p>
    </header>

    <!-- Quick Stats -->
    <div class="stats-bar" th:if="${devices != null}" th:with="total=${#lists.size(devices)}, activeCount=${activeDevices}, totalPower=${totalPower}">
        <div class="stat-item">
            <span class="stat-value" th:text="${total}">0</span>
            <span class="stat-label">Total Devices</span>
        </div>
        <div class="stat-item">
            <span class="stat-value stat-success" th:text="${activeCount}">0</span>
            <span class="stat-label">Active</span>
        </div>
        <div class="stat-item">
            <span class="stat-value stat-muted" th:text="${total - activeCount}">0</span>
            <span class="stat-label">Inactive</span>
        </div>
        <div class="stat-item">
            <span class="stat-value stat-primary" th:text="${totalPower + 'W'}">0W</span>
            <span class="stat-label">Power Draw</span>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">â• Create Device <span class="title-badge">Factory Method Pattern</span></h2>
        <div class="card">
            <form data-api-endpoint="/patterns/factory/create" data-api-method="POST" data-refresh="true">
                <div class="form-row">
                    <div>
                        <label for="type">Type</label>
                        <select id="type" name="type">
                            <option value="LIGHT">ğŸ’¡ Light</option>
                            <option value="THERMOSTAT">ğŸŒ¡ï¸ Thermostat</option>
                            <option value="CAMERA">ğŸ“· Camera</option>
                            <option value="LOCK">ğŸ”’ Lock</option>
                        </select>
                    </div>
                    <div>
                        <label for="location">Location</label>
                        <input id="location" name="location" placeholder="e.g. Living Room" required>
                    </div>
                </div>
                <label for="name">Name</label>
                <input id="name" name="name" placeholder="e.g. Desk Lamp" required>
                <button class="btn btn-primary" type="submit">
                    <span class="btn-icon">âš¡</span> Create Device
                </button>
            </form>
        </div>
    </div>

    <div class="section">
        <h2 class="section-title">ğŸ“‹ Current Devices</h2>

        <!-- Empty State -->
        <div th:if="${#lists.isEmpty(devices)}" class="empty-state">
            <div class="empty-icon">ğŸ“±</div>
            <h3>No devices yet</h3>
            <p>Create your first device using the form above.</p>
        </div>

        <div class="grid" th:unless="${#lists.isEmpty(devices)}">
            <div class="card device-card" th:each="device : ${devices}" th:attr="data-device-id=${device.id}">
                <div class="card-header">
                    <div class="card-title-group">
                        <span class="device-type-icon" th:text="${device.type.icon}">ğŸ’¡</span>
                        <div>
                            <span class="card-title" th:text="${device.info}">Device Name</span>
                            <span class="card-subtitle" th:text="${device.type.category}">Category</span>
                        </div>
                    </div>
                    <span class="device-status"
                          th:class="${device.isOn} ? 'device-status status-on' : 'device-status status-off'"
                          th:text="${device.isOn} ? 'â— ON' : 'â—‹ OFF'">OFF</span>
                </div>
                <div class="power-indicator">
                    <span>âš¡ Power:</span>
                    <span class="value" th:text="${device.power + 'W'}">0W</span>
                </div>
                <div class="device-actions">
                    <button class="btn btn-primary btn-sm device-control-btn" type="button" data-action="on" th:attr="data-device-id=${device.id}">Turn On</button>
                    <button class="btn btn-secondary btn-sm device-control-btn" type="button" data-action="off" th:attr="data-device-id=${device.id}">Turn Off</button>
                </div>
            </div>
        </div>
    </div>

    <details class="section">
        <summary class="section-title" style="cursor:pointer">ğŸ“‹ Output Log</summary>
        <div class="output-area">
            <pre id="output">Actions will appear hereâ€¦</pre>
        </div>
    </details>
</div>

<footer class="app-footer">
    <span>ğŸ  SmartHome OS</span>
    <a href="/swagger-ui.html" target="_blank">API Docs</a>
    <a href="/h2-console" target="_blank">DB Console</a>
</footer>

<script th:src="@{/js/app.js}"></script>
</body>
</html>
