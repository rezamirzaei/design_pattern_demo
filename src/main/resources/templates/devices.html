<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Smart Home ‚Äî Devices')}"></head>
<body>
    <nav th:replace="~{fragments/layout :: navbar('devices')}"></nav>
    <div th:replace="~{fragments/layout :: toasts}"></div>

    <main class="container" role="main">
        <header>
            <h1>üì± Devices</h1>
            <p class="subtitle">Manage your smart home devices ‚Äî create, control, and monitor</p>
        </header>

        <!-- Quick Stats -->
        <section class="stats-bar" aria-label="Device statistics"
                 th:if="${devices != null}"
                 th:with="total=${#lists.size(devices)}, activeCount=${activeDevices}, pw=${totalPower}">
            <div class="stat-item">
                <span class="stat-value" th:text="${total}">0</span>
                <span class="stat-label">Total Devices</span>
            </div>
            <div class="stat-item">
                <span class="stat-value stat-success" th:text="${activeCount}">0</span>
                <span class="stat-label">Active</span>
            </div>
            <div class="stat-item">
                <span class="stat-value stat-muted" th:text="${total - activeCount}">0</span>
                <span class="stat-label">Inactive</span>
            </div>
            <div class="stat-item">
                <span class="stat-value stat-primary" th:text="${pw + 'W'}">0W</span>
                <span class="stat-label">Power Draw</span>
            </div>
        </section>

        <section class="section" aria-label="Create device">
            <h2 class="section-title">‚ûï Create Device <span class="title-badge">Factory Method Pattern</span></h2>
            <div class="card">
                <form data-api-endpoint="/patterns/factory/create" data-api-method="POST" data-refresh="true"
                      aria-label="Create device form">
                    <div class="form-row">
                        <div>
                            <label for="deviceType">Type</label>
                            <select id="deviceType" name="type" required>
                                <option value="LIGHT">üí° Light</option>
                                <option value="THERMOSTAT">üå°Ô∏è Thermostat</option>
                                <option value="CAMERA">üì∑ Camera</option>
                                <option value="LOCK">üîí Lock</option>
                            </select>
                        </div>
                        <div>
                            <label for="deviceLocation">Location</label>
                            <input id="deviceLocation" name="location" placeholder="e.g. Living Room" required>
                        </div>
                    </div>
                    <label for="deviceName">Name</label>
                    <input id="deviceName" name="name" placeholder="e.g. Desk Lamp" required>
                    <button class="btn btn-primary" type="submit">‚ö° Create Device</button>
                </form>
            </div>
        </section>

        <section class="section" aria-label="Device list">
            <h2 class="section-title">üìã Current Devices</h2>

            <div th:if="${#lists.isEmpty(devices)}" class="empty-state">
                <div class="empty-icon">üì±</div>
                <h3>No devices yet</h3>
                <p>Create your first device using the form above.</p>
            </div>

            <div class="grid" th:unless="${#lists.isEmpty(devices)}">
                <div class="card device-card" th:each="device : ${devices}" th:attr="data-device-id=${device.id}">
                    <div class="card-header">
                        <div class="card-title-group">
                            <span class="device-type-icon" th:text="${device.type.icon}">üí°</span>
                            <div>
                                <span class="card-title" th:text="${device.info}">Device Name</span>
                                <span class="card-subtitle" th:text="${device.type.category}">Category</span>
                            </div>
                        </div>
                        <span class="device-status"
                              th:classappend="${device.isOn} ? 'status-on' : 'status-off'"
                              th:text="${device.isOn} ? '‚óè ON' : '‚óã OFF'">OFF</span>
                    </div>
                    <div class="power-indicator">
                        <span>‚ö° Power:</span>
                        <span class="value" th:text="${device.power + 'W'}">0W</span>
                    </div>
                    <div class="device-actions">
                        <button class="btn btn-primary btn-sm device-control-btn" type="button"
                                data-action="on" th:attr="data-device-id=${device.id}"
                                aria-label="Turn on">Turn On</button>
                        <button class="btn btn-secondary btn-sm device-control-btn" type="button"
                                data-action="off" th:attr="data-device-id=${device.id}"
                                aria-label="Turn off">Turn Off</button>
                    </div>
                </div>
            </div>
        </section>

        <div th:replace="~{fragments/layout :: outputLog}"></div>
    </main>

    <div th:replace="~{fragments/layout :: scripts}"></div>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>
