<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Smart Home ‚Äî Dashboard')}"></head>
<body>
    <nav th:replace="~{fragments/layout :: navbar('dashboard')}"></nav>
    <div th:replace="~{fragments/layout :: toasts}"></div>

    <main class="container" role="main">
        <header>
            <h1>üè† Smart Home Control Center</h1>
            <p class="subtitle">Interactive demonstration of all 23 Gang of Four Design Patterns</p>
        </header>

        <!-- ‚ïê‚ïê‚ïê System Overview ‚ïê‚ïê‚ïê -->
        <section class="stats-bar" aria-label="System overview">
            <div class="stat-item">
                <span class="stat-value" id="systemStatus" th:text="${systemStatus}">ONLINE</span>
                <span class="stat-label">System</span>
            </div>
            <div class="stat-item">
                <span class="stat-value stat-primary" id="homeMode" th:text="${homeMode}">NORMAL</span>
                <span class="stat-label">Home Mode</span>
            </div>
            <div class="stat-item">
                <span class="stat-value stat-success" id="activeDevices" th:text="${activeDevices}">0</span>
                <span class="stat-label">Active Devices</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" th:text="${#lists.size(devices)}">0</span>
                <span class="stat-label">Total Devices</span>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê Quick Actions ‚ïê‚ïê‚ïê -->
        <section class="section" aria-label="Quick actions">
            <h2 class="section-title">‚ö° Quick Actions</h2>
            <div class="quick-actions-grid">
                <div class="card quick-action-card">
                    <h3>üè† Home Mode</h3>
                    <p class="muted">Switch the system mode (Singleton pattern)</p>
                    <div class="mode-selector">
                        <button class="mode-btn" data-mode="NORMAL" type="button" aria-label="Normal mode">üè†<span>Normal</span></button>
                        <button class="mode-btn" data-mode="AWAY" type="button" aria-label="Away mode">üöó<span>Away</span></button>
                        <button class="mode-btn" data-mode="NIGHT" type="button" aria-label="Night mode">üåô<span>Night</span></button>
                        <button class="mode-btn" data-mode="VACATION" type="button" aria-label="Vacation mode">‚úàÔ∏è<span>Vacation</span></button>
                    </div>
                </div>
                <div class="card quick-action-card">
                    <h3>üé¨ Quick Scenes</h3>
                    <p class="muted">One-click presets (Facade pattern)</p>
                    <div class="mode-selector">
                        <button class="scene-btn" data-scene="movie" type="button">üé¨<span>Movie</span></button>
                        <button class="scene-btn" data-scene="morning" type="button">üåÖ<span>Morning</span></button>
                        <button class="scene-btn" data-scene="sleep" type="button">üò¥<span>Sleep</span></button>
                        <button class="scene-btn" data-scene="party" type="button">üéâ<span>Party</span></button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê Devices Summary ‚ïê‚ïê‚ïê -->
        <section class="section" aria-label="Device summary">
            <h2 class="section-title">üì± Devices
                <a th:href="@{/ui/devices}" class="section-link">View All ‚Üí</a>
            </h2>
            <div th:if="${#lists.isEmpty(devices)}" class="empty-state">
                <div class="empty-icon">üì±</div>
                <h3>No devices</h3>
                <p><a th:href="@{/ui/devices}">Create your first device</a></p>
            </div>
            <div class="grid" th:unless="${#lists.isEmpty(devices)}">
                <div class="card device-card" th:each="device : ${devices}" th:attr="data-device-id=${device.id}">
                    <div class="card-header">
                        <div class="card-title-group">
                            <span class="device-type-icon" th:text="${device.type.icon}">üí°</span>
                            <div>
                                <span class="card-title" th:text="${device.info}">Device</span>
                                <span class="card-subtitle" th:text="${device.location}">Location</span>
                            </div>
                        </div>
                        <span class="device-status"
                              th:classappend="${device.isOn} ? 'status-on' : 'status-off'"
                              th:text="${device.isOn} ? '‚óè ON' : '‚óã OFF'">OFF</span>
                    </div>
                    <div class="device-actions">
                        <button class="btn btn-primary btn-sm device-control-btn" type="button"
                                data-action="on" th:attr="data-device-id=${device.id}">On</button>
                        <button class="btn btn-secondary btn-sm device-control-btn" type="button"
                                data-action="off" th:attr="data-device-id=${device.id}">Off</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê Rooms Summary ‚ïê‚ïê‚ïê -->
        <section class="section" aria-label="Rooms summary" th:unless="${#lists.isEmpty(rooms)}">
            <h2 class="section-title">üè¢ Rooms
                <a th:href="@{/ui/rooms}" class="section-link">Manage ‚Üí</a>
            </h2>
            <div class="grid">
                <div class="card" th:each="room : ${rooms}">
                    <div class="card-header">
                        <span class="card-title" th:text="${room.name}">Room</span>
                        <span class="badge" th:text="${room.deviceCount + ' devices'}">0</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- ‚ïê‚ïê‚ïê Pattern Playground ‚ïê‚ïê‚ïê -->
        <section class="section" aria-label="Design patterns playground">
            <h2 class="section-title">üìê Design Patterns Playground
                <a th:href="@{/ui/patterns}" class="section-link">Full Lab ‚Üí</a>
            </h2>

            <nav class="pattern-nav" aria-label="Pattern selector">
                <span class="nav-section">üî® Creational:</span>
                <button class="nav-tab active" data-pattern="singleton">Singleton</button>
                <button class="nav-tab" data-pattern="factory">Factory</button>
                <button class="nav-tab" data-pattern="abstract-factory">Abstract Factory</button>
                <button class="nav-tab" data-pattern="builder">Builder</button>
                <button class="nav-tab" data-pattern="prototype">Prototype</button>
                <span class="nav-section">üèóÔ∏è Structural:</span>
                <button class="nav-tab" data-pattern="adapter">Adapter</button>
                <button class="nav-tab" data-pattern="bridge">Bridge</button>
                <button class="nav-tab" data-pattern="composite">Composite</button>
                <button class="nav-tab" data-pattern="decorator">Decorator</button>
                <button class="nav-tab" data-pattern="facade">Facade</button>
                <button class="nav-tab" data-pattern="flyweight">Flyweight</button>
                <button class="nav-tab" data-pattern="proxy">Proxy</button>
                <span class="nav-section">üé≠ Behavioral:</span>
                <button class="nav-tab" data-pattern="chain">Chain</button>
                <button class="nav-tab" data-pattern="command">Command</button>
                <button class="nav-tab" data-pattern="interpreter">Interpreter</button>
                <button class="nav-tab" data-pattern="iterator">Iterator</button>
                <button class="nav-tab" data-pattern="mediator">Mediator</button>
                <button class="nav-tab" data-pattern="memento">Memento</button>
                <button class="nav-tab" data-pattern="observer">Observer</button>
                <button class="nav-tab" data-pattern="state">State</button>
                <button class="nav-tab" data-pattern="strategy">Strategy</button>
                <button class="nav-tab" data-pattern="template">Template</button>
                <button class="nav-tab" data-pattern="visitor">Visitor</button>
            </nav>

            <div id="pattern-content">
                <th:block th:insert="~{patterns/singleton :: content}"></th:block>
                <th:block th:insert="~{patterns/factory :: content}"></th:block>
                <th:block th:insert="~{patterns/abstract-factory :: content}"></th:block>
                <th:block th:insert="~{patterns/builder :: content}"></th:block>
                <th:block th:insert="~{patterns/prototype :: content}"></th:block>
                <th:block th:insert="~{patterns/adapter :: content}"></th:block>
                <th:block th:insert="~{patterns/bridge :: content}"></th:block>
                <th:block th:insert="~{patterns/composite :: content}"></th:block>
                <th:block th:insert="~{patterns/decorator :: content}"></th:block>
                <th:block th:insert="~{patterns/facade :: content}"></th:block>
                <th:block th:insert="~{patterns/flyweight :: content}"></th:block>
                <th:block th:insert="~{patterns/proxy :: content}"></th:block>
                <th:block th:insert="~{patterns/chain :: content}"></th:block>
                <th:block th:insert="~{patterns/command :: content}"></th:block>
                <th:block th:insert="~{patterns/interpreter :: content}"></th:block>
                <th:block th:insert="~{patterns/iterator :: content}"></th:block>
                <th:block th:insert="~{patterns/mediator :: content}"></th:block>
                <th:block th:insert="~{patterns/memento :: content}"></th:block>
                <th:block th:insert="~{patterns/observer :: content}"></th:block>
                <th:block th:insert="~{patterns/state :: content}"></th:block>
                <th:block th:insert="~{patterns/strategy :: content}"></th:block>
                <th:block th:insert="~{patterns/template :: content}"></th:block>
                <th:block th:insert="~{patterns/visitor :: content}"></th:block>
            </div>
        </section>
    </main>

    <script>
        var PatternDemo = {
            toast: function(msg, type) {
                type = type || 'info';
                var c = document.getElementById('toastContainer');
                if (!c) return;
                var t = document.createElement('div');
                t.className = 'toast ' + type;
                t.textContent = msg;
                c.appendChild(t);
                setTimeout(function() { t.remove(); }, 3000);
            },
            showResult: function(id, text) {
                var el = document.getElementById(id);
                if (el) { el.textContent = text; el.classList.add('show'); }
            }
        };
        document.querySelectorAll('.nav-tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                var pattern = this.dataset.pattern;
                document.querySelectorAll('.nav-tab').forEach(function(t) { t.classList.remove('active'); });
                this.classList.add('active');
                document.querySelectorAll('.pattern-card').forEach(function(c) { c.classList.remove('active'); });
                var target = document.getElementById('pattern-' + pattern);
                if (target) target.classList.add('active');
            });
        });
    </script>
    <div th:replace="~{fragments/layout :: scripts}"></div>
    <script th:src="@{/js/patterns.js}"></script>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>
