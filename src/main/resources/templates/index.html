<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home - Design Patterns Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; color: #fff; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { text-align: center; padding: 30px 0; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 30px; }
        h1 { font-size: 2.5em; margin-bottom: 10px; background: linear-gradient(90deg, #00d2ff, #3a7bd5); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { color: #888; }
        .pattern-nav { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 25px; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 15px; }
        .nav-tab { padding: 10px 18px; background: transparent; border: none; color: #888; cursor: pointer; border-radius: 10px; transition: all 0.3s; font-size: 0.9em; }
        .nav-tab:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-tab.active { background: linear-gradient(90deg, #00d2ff, #3a7bd5); color: white; }
        .nav-section { font-weight: bold; color: #666; padding: 10px 12px; }
        .pattern-card { background: rgba(255,255,255,0.03); border-radius: 20px; padding: 25px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.08); display: none; }
        .pattern-card.active { display: block; }
        .pattern-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .pattern-icon { font-size: 2.5em; }
        .pattern-info h3 { font-size: 1.4em; margin-bottom: 5px; }
        .pattern-badge { display: inline-block; padding: 4px 12px; border-radius: 15px; font-size: 0.75em; text-transform: uppercase; }
        .badge-creational { background: rgba(255, 193, 7, 0.2); color: #ffc107; }
        .badge-structural { background: rgba(40, 167, 69, 0.2); color: #28a745; }
        .badge-behavioral { background: rgba(220, 53, 69, 0.2); color: #dc3545; }
        .pattern-desc { color: #aaa; line-height: 1.6; margin-bottom: 20px; }
        .pattern-demo { background: rgba(0,0,0,0.2); border-radius: 15px; padding: 20px; }
        .pattern-demo h4 { color: #00d2ff; margin-bottom: 15px; }
        .form-input { padding: 10px 14px; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.08); color: white; }
        .form-input:focus { outline: none; border-color: #00d2ff; }
        .result-area { margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; border-left: 3px solid #00d2ff; font-family: monospace; font-size: 0.85em; white-space: pre-wrap; display: none; max-height: 200px; overflow-y: auto; color: #7ee787; }
        .result-area.show { display: block; }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .toast { padding: 12px 20px; border-radius: 10px; margin-bottom: 10px; color: white; }
        .toast.success { background: rgba(0,200,100,0.95); }
        .toast.error { background: rgba(220,53,69,0.95); }
        .toast.info { background: rgba(0,210,255,0.95); }
        .status-panel { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px; }
        .status-item { background: rgba(255,255,255,0.05); padding: 12px 18px; border-radius: 10px; text-align: center; min-width: 100px; }
        .status-label { display: block; font-size: 0.75em; color: #888; margin-bottom: 5px; }
        .status-value { font-size: 1.2em; font-weight: bold; color: #00d2ff; }
        .mode-selector { display: flex; flex-wrap: wrap; gap: 12px; }
        .mode-btn { display: flex; flex-direction: column; align-items: center; padding: 15px 25px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 15px; color: white; cursor: pointer; transition: all 0.3s; min-width: 100px; }
        .mode-btn:hover { background: rgba(0,210,255,0.1); border-color: rgba(0,210,255,0.4); transform: translateY(-3px); }
        .mode-btn.active { background: rgba(0,210,255,0.2); border-color: #00d2ff; }
        .mode-icon { font-size: 2em; margin-bottom: 8px; }
        .mode-name { font-weight: 600; }
        .mode-desc { font-size: 0.75em; color: #888; }
        .scene-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .scene-card { padding: 20px; background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 15px; cursor: pointer; transition: all 0.3s; text-align: center; }
        .scene-card:hover { background: rgba(0,210,255,0.1); border-color: rgba(0,210,255,0.5); }
        .scene-icon { font-size: 2.5em; margin-bottom: 10px; }
        .scene-name { font-weight: 600; margin-bottom: 5px; }
        .scene-desc { font-size: 0.75em; color: #888; }
        .device-list { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .device-item { display: flex; align-items: center; gap: 10px; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; cursor: pointer; }
        .device-item.active { background: rgba(0,210,255,0.2); border-color: #00d2ff; }
        .feature-list { display: flex; flex-direction: column; gap: 10px; }
        .feature-checkbox { cursor: pointer; }
        .feature-checkbox input { display: none; }
        .feature-box { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; }
        .feature-checkbox input:checked + .feature-box { background: rgba(0,210,255,0.15); border-color: #00d2ff; }
        .feature-icon { font-size: 1.5em; }
        .feature-info { display: flex; flex-direction: column; }
        .feature-name { font-weight: 600; }
        .feature-desc { font-size: 0.8em; color: #888; }
        .chain-visual { display: flex; align-items: center; flex-wrap: wrap; gap: 8px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px; margin-top: 15px; }
        .chain-item { padding: 8px 14px; border-radius: 8px; }
        .chain-item.base { background: rgba(100,100,100,0.3); color: #ccc; }
        .chain-item.decorator { background: rgba(0,210,255,0.2); color: #00d2ff; }
        .chain-arrow { color: #666; }
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    <div class="container">
        <header>
            <h1>ğŸ  Smart Home Control Center</h1>
            <p class="subtitle">Interactive demonstration of all 23 Gang of Four Design Patterns</p>
        </header>

        <nav class="pattern-nav">
            <span class="nav-section">ğŸ”¨ Creational:</span>
            <button class="nav-tab active" data-pattern="singleton">Singleton</button>
            <button class="nav-tab" data-pattern="factory">Factory</button>
            <button class="nav-tab" data-pattern="abstract-factory">Abstract Factory</button>
            <button class="nav-tab" data-pattern="builder">Builder</button>
            <button class="nav-tab" data-pattern="prototype">Prototype</button>
            <span class="nav-section">ğŸ—ï¸ Structural:</span>
            <button class="nav-tab" data-pattern="adapter">Adapter</button>
            <button class="nav-tab" data-pattern="bridge">Bridge</button>
            <button class="nav-tab" data-pattern="composite">Composite</button>
            <button class="nav-tab" data-pattern="decorator">Decorator</button>
            <button class="nav-tab" data-pattern="facade">Facade</button>
            <button class="nav-tab" data-pattern="flyweight">Flyweight</button>
            <button class="nav-tab" data-pattern="proxy">Proxy</button>
            <span class="nav-section">ğŸ­ Behavioral:</span>
            <button class="nav-tab" data-pattern="chain">Chain</button>
            <button class="nav-tab" data-pattern="command">Command</button>
            <button class="nav-tab" data-pattern="interpreter">Interpreter</button>
            <button class="nav-tab" data-pattern="iterator">Iterator</button>
            <button class="nav-tab" data-pattern="mediator">Mediator</button>
            <button class="nav-tab" data-pattern="memento">Memento</button>
            <button class="nav-tab" data-pattern="observer">Observer</button>
            <button class="nav-tab" data-pattern="state">State</button>
            <button class="nav-tab" data-pattern="strategy">Strategy</button>
            <button class="nav-tab" data-pattern="template">Template</button>
            <button class="nav-tab" data-pattern="visitor">Visitor</button>
        </nav>

        <div id="pattern-content">
            <!-- 1. SINGLETON -->
            <div class="pattern-card active" id="pattern-singleton">
                <div class="pattern-header"><div class="pattern-icon">ğŸ </div><div class="pattern-info"><h3>Home Mode Controller</h3><span class="pattern-badge badge-creational">Singleton</span></div></div>
                <p class="pattern-desc">Only ONE HomeController instance manages your entire smart home. When you change the mode, all devices respond through this single coordinator.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Select Home Mode</h4>
                    <div class="mode-selector">
                        <button class="mode-btn active" id="mode-normal" onclick="P.setMode('NORMAL')"><span class="mode-icon">ğŸ¡</span><span class="mode-name">Normal</span><span class="mode-desc">Regular daily operation</span></button>
                        <button class="mode-btn" id="mode-away" onclick="P.setMode('AWAY')"><span class="mode-icon">ğŸš—</span><span class="mode-name">Away</span><span class="mode-desc">Security active</span></button>
                        <button class="mode-btn" id="mode-night" onclick="P.setMode('NIGHT')"><span class="mode-icon">ğŸŒ™</span><span class="mode-name">Night</span><span class="mode-desc">Dimmed lights</span></button>
                        <button class="mode-btn" id="mode-vacation" onclick="P.setMode('VACATION')"><span class="mode-icon">ğŸ–ï¸</span><span class="mode-name">Vacation</span><span class="mode-desc">Max security</span></button>
                    </div>
                    <div class="status-panel">
                        <div class="status-item"><span class="status-label">Mode</span><span class="status-value" id="singleton-mode">NORMAL</span></div>
                        <div class="status-item"><span class="status-label">Active Devices</span><span class="status-value" id="singleton-devices">0</span></div>
                    </div>
                </div>
                <div class="result-area" id="singleton-result"></div>
            </div>

            <!-- 2. FACTORY -->
            <div class="pattern-card" id="pattern-factory">
                <div class="pattern-header"><div class="pattern-icon">ğŸ­</div><div class="pattern-info"><h3>Device Factory</h3><span class="pattern-badge badge-creational">Factory Method</span></div></div>
                <p class="pattern-desc">Create different types of smart devices without knowing their exact implementation classes.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Create New Device</h4>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                        <select id="factory-type" class="form-input"><option value="LIGHT">ğŸ’¡ Light</option><option value="THERMOSTAT">ğŸŒ¡ï¸ Thermostat</option><option value="CAMERA">ğŸ“· Camera</option><option value="LOCK">ğŸ”’ Lock</option></select>
                        <input type="text" id="factory-name" class="form-input" value="New Device">
                        <input type="text" id="factory-location" class="form-input" value="Living Room">
                        <button class="mode-btn" onclick="P.createDevice()" style="padding:10px 20px;min-width:auto;">â• Create</button>
                    </div>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.quickDevice('LIGHT','Kitchen Light','Kitchen')"><span class="mode-icon">ğŸ’¡</span><span class="mode-name">Add Light</span></button>
                        <button class="mode-btn" onclick="P.quickDevice('THERMOSTAT','Thermo','Bedroom')"><span class="mode-icon">ğŸŒ¡ï¸</span><span class="mode-name">Add Thermo</span></button>
                        <button class="mode-btn" onclick="P.quickDevice('CAMERA','Cam','Entrance')"><span class="mode-icon">ğŸ“·</span><span class="mode-name">Add Camera</span></button>
                    </div>
                </div>
                <div class="result-area" id="factory-result"></div>
            </div>

            <!-- 3. ABSTRACT FACTORY -->
            <div class="pattern-card" id="pattern-abstract-factory">
                <div class="pattern-header"><div class="pattern-icon">ğŸ¢</div><div class="pattern-info"><h3>Ecosystem Factory</h3><span class="pattern-badge badge-creational">Abstract Factory</span></div></div>
                <p class="pattern-desc">Create families of related devices for different ecosystems.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Create Ecosystem</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.abstractFactory('SMARTTHINGS')"><span class="mode-icon">ğŸ”·</span><span class="mode-name">SmartThings</span></button>
                        <button class="mode-btn" onclick="P.abstractFactory('HOMEKIT')"><span class="mode-icon">ğŸ</span><span class="mode-name">HomeKit</span></button>
                    </div>
                </div>
                <div class="result-area" id="abstract-factory-result"></div>
            </div>

            <!-- 4. BUILDER -->
            <div class="pattern-card" id="pattern-builder">
                <div class="pattern-header"><div class="pattern-icon">ğŸ”§</div><div class="pattern-info"><h3>Automation Rule Builder</h3><span class="pattern-badge badge-creational">Builder</span></div></div>
                <p class="pattern-desc">Construct complex automation rules step by step.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Build Automation Rule</h4>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                        <input type="text" id="builder-name" class="form-input" value="Morning Routine">
                        <select id="builder-trigger" class="form-input"><option value="time:07:00">â° 7:00 AM</option><option value="motion">ğŸš¶ Motion</option></select>
                        <select id="builder-action" class="form-input"><option value="lights:on">ğŸ’¡ Lights On</option><option value="lights:off">ğŸ’¡ Lights Off</option></select>
                        <button class="mode-btn" onclick="P.buildRule()" style="padding:10px 20px;min-width:auto;">ğŸ”¨ Build</button>
                    </div>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.buildPreset('morning')"><span class="mode-icon">ğŸŒ…</span><span class="mode-name">Morning</span></button>
                        <button class="mode-btn" onclick="P.buildPreset('night')"><span class="mode-icon">ğŸŒ™</span><span class="mode-name">Night</span></button>
                    </div>
                </div>
                <div class="result-area" id="builder-result"></div>
            </div>

            <!-- 5. PROTOTYPE -->
            <div class="pattern-card" id="pattern-prototype">
                <div class="pattern-header"><div class="pattern-icon">ğŸ“‹</div><div class="pattern-info"><h3>Device Clone</h3><span class="pattern-badge badge-creational">Prototype</span></div></div>
                <p class="pattern-desc">Clone existing device configurations.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Clone Templates</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.clone('ambient-light')"><span class="mode-icon">ğŸ’¡</span><span class="mode-name">Ambient Light</span></button>
                        <button class="mode-btn" onclick="P.clone('security-cam')"><span class="mode-icon">ğŸ“·</span><span class="mode-name">Security Cam</span></button>
                    </div>
                </div>
                <div class="result-area" id="prototype-result"></div>
            </div>

            <!-- 6. ADAPTER -->
            <div class="pattern-card" id="pattern-adapter">
                <div class="pattern-header"><div class="pattern-icon">ğŸ”Œ</div><div class="pattern-info"><h3>Legacy Device Adapter</h3><span class="pattern-badge badge-structural">Adapter</span></div></div>
                <p class="pattern-desc">Connect incompatible legacy devices to your modern system.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Adapt Legacy Device</h4>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <input type="text" id="adapter-name" class="form-input" value="Old Thermostat">
                        <input type="text" id="adapter-location" class="form-input" value="Basement">
                        <button class="mode-btn" onclick="P.adapt()" style="padding:10px 20px;min-width:auto;">ğŸ”Œ Adapt</button>
                    </div>
                </div>
                <div class="result-area" id="adapter-result"></div>
            </div>

            <!-- 7. BRIDGE -->
            <div class="pattern-card" id="pattern-bridge">
                <div class="pattern-header"><div class="pattern-icon">ğŸŒ‰</div><div class="pattern-info"><h3>Remote Control Bridge</h3><span class="pattern-badge badge-structural">Bridge</span></div></div>
                <p class="pattern-desc">Decouple remote controls from devices.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Test Bridge</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.bridge('basic','light')"><span class="mode-icon">ğŸ“±</span><span class="mode-name">Basicâ†’Light</span></button>
                        <button class="mode-btn" onclick="P.bridge('advanced','tv')"><span class="mode-icon">ğŸ“²</span><span class="mode-name">Advancedâ†’TV</span></button>
                    </div>
                </div>
                <div class="result-area" id="bridge-result"></div>
            </div>

            <!-- 8. COMPOSITE -->
            <div class="pattern-card" id="pattern-composite">
                <div class="pattern-header"><div class="pattern-icon">ğŸ¢</div><div class="pattern-info"><h3>Room Groups</h3><span class="pattern-badge badge-structural">Composite</span></div></div>
                <p class="pattern-desc">Control entire rooms as single units.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Control Rooms</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.composite('Living Room','on')"><span class="mode-icon">ğŸ›‹ï¸</span><span class="mode-name">Living ON</span></button>
                        <button class="mode-btn" onclick="P.composite('Living Room','off')"><span class="mode-icon">ğŸ›‹ï¸</span><span class="mode-name">Living OFF</span></button>
                        <button class="mode-btn" onclick="P.composite('Bedroom','on')"><span class="mode-icon">ğŸ›ï¸</span><span class="mode-name">Bedroom ON</span></button>
                    </div>
                </div>
                <div class="result-area" id="composite-result"></div>
            </div>

            <!-- 9. DECORATOR -->
            <div class="pattern-card" id="pattern-decorator">
                <div class="pattern-header"><div class="pattern-icon">ğŸ¨</div><div class="pattern-info"><h3>Add Features to Devices</h3><span class="pattern-badge badge-structural">Decorator</span></div></div>
                <p class="pattern-desc">Dynamically add Logging, Security, or Caching to any device.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Wrap Device with Features</h4>
                    <div class="device-list">
                        <button class="device-item active" id="dec-dev-1" onclick="P.selectDecDevice(this,'living-light')">ğŸ’¡ Living Light</button>
                        <button class="device-item" id="dec-dev-2" onclick="P.selectDecDevice(this,'thermostat')">ğŸŒ¡ï¸ Thermostat</button>
                        <button class="device-item" id="dec-dev-3" onclick="P.selectDecDevice(this,'camera')">ğŸ“· Camera</button>
                    </div>
                    <div class="feature-list">
                        <label class="feature-checkbox"><input type="checkbox" id="dec-logging" checked><span class="feature-box"><span class="feature-icon">ğŸ“</span><span class="feature-info"><span class="feature-name">Logging</span><span class="feature-desc">Record all operations</span></span></span></label>
                        <label class="feature-checkbox"><input type="checkbox" id="dec-security"><span class="feature-box"><span class="feature-icon">ğŸ”</span><span class="feature-info"><span class="feature-name">Security</span><span class="feature-desc">Add access control</span></span></span></label>
                        <label class="feature-checkbox"><input type="checkbox" id="dec-caching"><span class="feature-box"><span class="feature-icon">âš¡</span><span class="feature-info"><span class="feature-name">Caching</span><span class="feature-desc">Cache state for speed</span></span></span></label>
                    </div>
                    <div class="chain-visual" id="decorator-chain"><span class="chain-item base">ğŸ“± Device</span><span class="chain-arrow">â†’</span><span class="chain-item decorator">ğŸ“ Logging</span></div>
                    <button class="mode-btn" onclick="P.applyDecorators()" style="margin-top:15px;width:100%;">ğŸ Apply Decorators</button>
                </div>
                <div class="result-area" id="decorator-result"></div>
            </div>

            <!-- 10. FACADE -->
            <div class="pattern-card" id="pattern-facade">
                <div class="pattern-header"><div class="pattern-icon">ğŸ¬</div><div class="pattern-info"><h3>Smart Home Scenes</h3><span class="pattern-badge badge-structural">Facade</span></div></div>
                <p class="pattern-desc">One-click scenes that orchestrate multiple devices.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Activate Scene</h4>
                    <div class="scene-grid">
                        <button class="scene-card" onclick="P.scene('morning')"><div class="scene-icon">ğŸŒ…</div><div class="scene-name">Morning</div><div class="scene-desc">Lights on, blinds open</div></button>
                        <button class="scene-card" onclick="P.scene('night')"><div class="scene-icon">ğŸŒ™</div><div class="scene-name">Night</div><div class="scene-desc">Lights off, doors locked</div></button>
                        <button class="scene-card" onclick="P.scene('movie')"><div class="scene-icon">ğŸ¬</div><div class="scene-name">Movie</div><div class="scene-desc">Dim lights, TV on</div></button>
                        <button class="scene-card" onclick="P.scene('party')"><div class="scene-icon">ğŸ‰</div><div class="scene-name">Party</div><div class="scene-desc">Color lights, music</div></button>
                        <button class="scene-card" onclick="P.scene('leave')"><div class="scene-icon">ğŸšª</div><div class="scene-name">Leave</div><div class="scene-desc">All off, security on</div></button>
                        <button class="scene-card" onclick="P.scene('arrive')"><div class="scene-icon">ğŸ </div><div class="scene-name">Arrive</div><div class="scene-desc">Welcome home</div></button>
                    </div>
                </div>
                <div class="result-area" id="facade-result"></div>
            </div>

            <!-- 11. FLYWEIGHT -->
            <div class="pattern-card" id="pattern-flyweight">
                <div class="pattern-header"><div class="pattern-icon">ğŸª¶</div><div class="pattern-info"><h3>Device Type Cache</h3><span class="pattern-badge badge-structural">Flyweight</span></div></div>
                <p class="pattern-desc">Share device type metadata to reduce memory.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® View Memory Optimization</h4>
                    <button class="mode-btn" onclick="P.flyweight()"><span class="mode-icon">ğŸ’¾</span><span class="mode-name">Show Savings</span></button>
                </div>
                <div class="result-area" id="flyweight-result"></div>
            </div>

            <!-- 12. PROXY -->
            <div class="pattern-card" id="pattern-proxy">
                <div class="pattern-header"><div class="pattern-icon">ğŸ›¡ï¸</div><div class="pattern-info"><h3>Remote Device Proxy</h3><span class="pattern-badge badge-structural">Proxy</span></div></div>
                <p class="pattern-desc">Access remote devices through a proxy.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Connect Remote Device</h4>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px;">
                        <input type="text" id="proxy-name" class="form-input" value="Garage Cam">
                        <input type="text" id="proxy-ip" class="form-input" value="192.168.1.100">
                        <button class="mode-btn" onclick="P.proxy()" style="padding:10px 20px;min-width:auto;">ğŸŒ Connect</button>
                    </div>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.quickProxy('Garage Cam','192.168.1.50')"><span class="mode-icon">ğŸ“·</span><span class="mode-name">Garage</span></button>
                        <button class="mode-btn" onclick="P.quickProxy('Doorbell','192.168.1.51')"><span class="mode-icon">ğŸšª</span><span class="mode-name">Doorbell</span></button>
                    </div>
                </div>
                <div class="result-area" id="proxy-result"></div>
            </div>

            <!-- 13. CHAIN -->
            <div class="pattern-card" id="pattern-chain">
                <div class="pattern-header"><div class="pattern-icon">â›“ï¸</div><div class="pattern-info"><h3>Alert Handler Chain</h3><span class="pattern-badge badge-behavioral">Chain of Responsibility</span></div></div>
                <p class="pattern-desc">Pass alerts through a chain of handlers.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Trigger Alerts</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.alert('INFO','Motion detected')"><span class="mode-icon">â„¹ï¸</span><span class="mode-name">INFO</span></button>
                        <button class="mode-btn" onclick="P.alert('WARNING','Unknown visitor')"><span class="mode-icon">âš ï¸</span><span class="mode-name">WARNING</span></button>
                        <button class="mode-btn" onclick="P.alert('CRITICAL','Window opened')"><span class="mode-icon">ğŸš¨</span><span class="mode-name">CRITICAL</span></button>
                        <button class="mode-btn" onclick="P.alert('EMERGENCY','Smoke detected')"><span class="mode-icon">ğŸ”¥</span><span class="mode-name">EMERGENCY</span></button>
                    </div>
                </div>
                <div class="result-area" id="chain-result"></div>
            </div>

            <!-- 14. COMMAND -->
            <div class="pattern-card" id="pattern-command">
                <div class="pattern-header"><div class="pattern-icon">ğŸ“œ</div><div class="pattern-info"><h3>Device Control with Undo/Redo</h3><span class="pattern-badge badge-behavioral">Command</span></div></div>
                <p class="pattern-desc">Every action is a Command object that can be undone.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Control with History</h4>
                    <div class="mode-selector" style="margin-bottom:15px;">
                        <button class="mode-btn" onclick="P.command('light','ON')"><span class="mode-icon">ğŸ’¡</span><span class="mode-name">Light ON</span></button>
                        <button class="mode-btn" onclick="P.command('light','OFF')"><span class="mode-icon">ğŸ”Œ</span><span class="mode-name">Light OFF</span></button>
                    </div>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.undo()"><span class="mode-icon">â†©ï¸</span><span class="mode-name">Undo</span></button>
                        <button class="mode-btn" onclick="P.redo()"><span class="mode-icon">â†ªï¸</span><span class="mode-name">Redo</span></button>
                    </div>
                </div>
                <div class="result-area" id="command-result"></div>
            </div>

            <!-- 15. INTERPRETER -->
            <div class="pattern-card" id="pattern-interpreter">
                <div class="pattern-header"><div class="pattern-icon">ğŸ“–</div><div class="pattern-info"><h3>Rule Interpreter</h3><span class="pattern-badge badge-behavioral">Interpreter</span></div></div>
                <p class="pattern-desc">Evaluate automation expressions.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Evaluate Expression</h4>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <input type="text" id="interpreter-rule" class="form-input" value="light_is_on AND motion_detected" style="flex:1;">
                        <button class="mode-btn" onclick="P.interpret()" style="padding:10px 20px;min-width:auto;">ğŸ” Evaluate</button>
                    </div>
                </div>
                <div class="result-area" id="interpreter-result"></div>
            </div>

            <!-- 16. ITERATOR -->
            <div class="pattern-card" id="pattern-iterator">
                <div class="pattern-header"><div class="pattern-icon">ğŸ”„</div><div class="pattern-info"><h3>Device Iterator</h3><span class="pattern-badge badge-behavioral">Iterator</span></div></div>
                <p class="pattern-desc">Traverse collections without exposing structure.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Browse Devices</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.iterate('ALL','')"><span class="mode-icon">ğŸ“±</span><span class="mode-name">All</span></button>
                        <button class="mode-btn" onclick="P.iterate('ROOM','Living Room')"><span class="mode-icon">ğŸ›‹ï¸</span><span class="mode-name">Living</span></button>
                        <button class="mode-btn" onclick="P.iterate('TYPE','LIGHT')"><span class="mode-icon">ğŸ’¡</span><span class="mode-name">Lights</span></button>
                    </div>
                </div>
                <div class="result-area" id="iterator-result"></div>
            </div>

            <!-- 17. MEDIATOR -->
            <div class="pattern-card" id="pattern-mediator">
                <div class="pattern-header"><div class="pattern-icon">ğŸ›ï¸</div><div class="pattern-info"><h3>Smart Home Hub</h3><span class="pattern-badge badge-behavioral">Mediator</span></div></div>
                <p class="pattern-desc">Central hub coordinates all device communication.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Trigger Hub Events</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.mediator('sensor','MOTION_DETECTED')"><span class="mode-icon">ğŸš¶</span><span class="mode-name">Motion</span></button>
                        <button class="mode-btn" onclick="P.mediator('door','DOOR_OPENED')"><span class="mode-icon">ğŸšª</span><span class="mode-name">Door Open</span></button>
                        <button class="mode-btn" onclick="P.mediator('smoke','SMOKE_DETECTED')"><span class="mode-icon">ğŸ”¥</span><span class="mode-name">Smoke</span></button>
                    </div>
                </div>
                <div class="result-area" id="mediator-result"></div>
            </div>

            <!-- 18. MEMENTO -->
            <div class="pattern-card" id="pattern-memento">
                <div class="pattern-header"><div class="pattern-icon">ğŸ“¸</div><div class="pattern-info"><h3>State Snapshot</h3><span class="pattern-badge badge-behavioral">Memento</span></div></div>
                <p class="pattern-desc">Save and restore home state snapshots.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Manage Snapshots</h4>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <input type="text" id="memento-name" class="form-input" value="Morning Setup">
                        <button class="mode-btn" onclick="P.saveMemento()" style="padding:10px 15px;min-width:auto;">ğŸ“¸ Save</button>
                        <button class="mode-btn" onclick="P.listMementos()" style="padding:10px 15px;min-width:auto;">ğŸ“‹ List</button>
                        <button class="mode-btn" onclick="P.restoreMemento()" style="padding:10px 15px;min-width:auto;">âª Restore</button>
                    </div>
                </div>
                <div class="result-area" id="memento-result"></div>
            </div>

            <!-- 19. OBSERVER -->
            <div class="pattern-card" id="pattern-observer">
                <div class="pattern-header"><div class="pattern-icon">ğŸ‘€</div><div class="pattern-info"><h3>Device Event Notifications</h3><span class="pattern-badge badge-behavioral">Observer</span></div></div>
                <p class="pattern-desc">Subscribe to device events and get notified.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Subscribe to Events</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.observer('sensor','MOBILE')"><span class="mode-icon">ğŸ“±</span><span class="mode-name">Mobileâ†’Sensor</span></button>
                        <button class="mode-btn" onclick="P.observer('camera','EMAIL')"><span class="mode-icon">ğŸ“§</span><span class="mode-name">Emailâ†’Camera</span></button>
                        <button class="mode-btn" onclick="P.observer('door','DASHBOARD')"><span class="mode-icon">ğŸ“Š</span><span class="mode-name">Dashboardâ†’Door</span></button>
                    </div>
                </div>
                <div class="result-area" id="observer-result"></div>
            </div>

            <!-- 20. STATE -->
            <div class="pattern-card" id="pattern-state">
                <div class="pattern-header"><div class="pattern-icon">ğŸ”„</div><div class="pattern-info"><h3>Device State Machine</h3><span class="pattern-badge badge-behavioral">State</span></div></div>
                <p class="pattern-desc">Device behavior changes based on state.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Media Player</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.state('play')"><span class="mode-icon">â–¶ï¸</span><span class="mode-name">Play</span></button>
                        <button class="mode-btn" onclick="P.state('pause')"><span class="mode-icon">â¸ï¸</span><span class="mode-name">Pause</span></button>
                        <button class="mode-btn" onclick="P.state('stop')"><span class="mode-icon">â¹ï¸</span><span class="mode-name">Stop</span></button>
                    </div>
                    <div class="status-panel"><div class="status-item"><span class="status-label">State</span><span class="status-value" id="state-current">STOPPED</span></div></div>
                </div>
                <div class="result-area" id="state-result"></div>
            </div>

            <!-- 21. STRATEGY -->
            <div class="pattern-card" id="pattern-strategy">
                <div class="pattern-header"><div class="pattern-icon">âš¡</div><div class="pattern-info"><h3>Energy Strategy</h3><span class="pattern-badge badge-behavioral">Strategy</span></div></div>
                <p class="pattern-desc">Switch between different energy algorithms.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Select Energy Mode</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.strategy('NORMAL')"><span class="mode-icon">âš¡</span><span class="mode-name">Normal</span><span class="mode-desc">100%</span></button>
                        <button class="mode-btn" onclick="P.strategy('ECO')"><span class="mode-icon">ğŸŒ¿</span><span class="mode-name">Eco</span><span class="mode-desc">70%</span></button>
                        <button class="mode-btn" onclick="P.strategy('PERFORMANCE')"><span class="mode-icon">ğŸš€</span><span class="mode-name">Performance</span><span class="mode-desc">130%</span></button>
                    </div>
                    <div class="status-panel">
                        <div class="status-item"><span class="status-label">Strategy</span><span class="status-value" id="strategy-current">NORMAL</span></div>
                        <div class="status-item"><span class="status-label">Power</span><span class="status-value" id="strategy-power">100%</span></div>
                    </div>
                </div>
                <div class="result-area" id="strategy-result"></div>
            </div>

            <!-- 22. TEMPLATE -->
            <div class="pattern-card" id="pattern-template">
                <div class="pattern-header"><div class="pattern-icon">ğŸ“‹</div><div class="pattern-info"><h3>Device Init Template</h3><span class="pattern-badge badge-behavioral">Template Method</span></div></div>
                <p class="pattern-desc">Standard initialization with device-specific steps.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Initialize Devices</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.template('LIGHT')"><span class="mode-icon">ğŸ’¡</span><span class="mode-name">Init Light</span></button>
                        <button class="mode-btn" onclick="P.template('THERMOSTAT')"><span class="mode-icon">ğŸŒ¡ï¸</span><span class="mode-name">Init Thermo</span></button>
                        <button class="mode-btn" onclick="P.template('CAMERA')"><span class="mode-icon">ğŸ“·</span><span class="mode-name">Init Camera</span></button>
                    </div>
                </div>
                <div class="result-area" id="template-result"></div>
            </div>

            <!-- 23. VISITOR -->
            <div class="pattern-card" id="pattern-visitor">
                <div class="pattern-header"><div class="pattern-icon">ğŸ”</div><div class="pattern-info"><h3>Home Audit</h3><span class="pattern-badge badge-behavioral">Visitor</span></div></div>
                <p class="pattern-desc">Run audits without modifying device classes.</p>
                <div class="pattern-demo">
                    <h4>ğŸ® Run Audits</h4>
                    <div class="mode-selector">
                        <button class="mode-btn" onclick="P.visitor('energy')"><span class="mode-icon">âš¡</span><span class="mode-name">Energy</span></button>
                        <button class="mode-btn" onclick="P.visitor('security')"><span class="mode-icon">ğŸ”</span><span class="mode-name">Security</span></button>
                        <button class="mode-btn" onclick="P.visitor('maintenance')"><span class="mode-icon">ğŸ”§</span><span class="mode-name">Maintenance</span></button>
                    </div>
                </div>
                <div class="result-area" id="visitor-result"></div>
            </div>
        </div>
    </div>

    <script>
        function toast(m,t){t=t||'info';var c=document.getElementById('toastContainer');var e=document.createElement('div');e.className='toast '+t;e.textContent=m;c.appendChild(e);setTimeout(function(){e.remove();},3000);}
        function showResult(id,t){var e=document.getElementById(id);if(e){e.textContent=t;e.classList.add('show');}}
        function api(m,u,p){var url='/api'+u;if(p)url+='?'+new URLSearchParams(p).toString();return fetch(url,{method:m}).then(function(r){return r.json();}).catch(function(e){toast('Error','error');return null;});}
        var decoratorDevice='living-light';
        var P={
            setMode:function(m){document.querySelectorAll('#pattern-singleton .mode-btn').forEach(function(b){b.classList.remove('active');});document.getElementById('mode-'+m.toLowerCase()).classList.add('active');api('POST','/mode/'+m).then(function(d){if(d){document.getElementById('singleton-mode').textContent=d.homeMode||m;document.getElementById('singleton-devices').textContent=d.activeDevices||0;showResult('singleton-result','Mode: '+m+'\n'+JSON.stringify(d,null,2));toast('Mode: '+m,'success');}});},
            createDevice:function(){var t=document.getElementById('factory-type').value,n=document.getElementById('factory-name').value,l=document.getElementById('factory-location').value;this.quickDevice(t,n,l);},
            quickDevice:function(t,n,l){api('POST','/patterns/factory/create',{type:t,name:n,location:l}).then(function(d){showResult('factory-result','Created '+t+'!\n'+JSON.stringify(d,null,2));toast('Created: '+n,'success');});},
            abstractFactory:function(e){api('POST','/patterns/abstract-factory/create',{ecosystem:e,location:'Living Room'}).then(function(d){showResult('abstract-factory-result',e+' created!\n'+JSON.stringify(d,null,2));toast(e+' created','success');});},
            buildRule:function(){var n=document.getElementById('builder-name').value,t=document.getElementById('builder-trigger').value,a=document.getElementById('builder-action').value;api('POST','/patterns/builder/rule',{name:n,trigger:t,action:a}).then(function(d){showResult('builder-result','Rule: '+n+'\n'+JSON.stringify(d,null,2));toast('Rule: '+n,'success');});},
            buildPreset:function(p){var presets={morning:{name:'Morning',trigger:'time:07:00',action:'lights:on'},night:{name:'Night',trigger:'time:22:00',action:'lights:off'}};api('POST','/patterns/builder/rule',presets[p]).then(function(d){showResult('builder-result','Preset: '+presets[p].name+'\n'+JSON.stringify(d,null,2));toast('Preset: '+presets[p].name,'success');});},
            clone:function(t){api('GET','/patterns/prototype/templates').then(function(d){showResult('prototype-result','Cloned: '+t+'\n'+JSON.stringify(d,null,2));toast('Cloned: '+t,'success');});},
            adapt:function(){var n=document.getElementById('adapter-name').value,l=document.getElementById('adapter-location').value;api('POST','/patterns/adapter/legacy',{name:n,location:l}).then(function(d){showResult('adapter-result','Adapted: '+n+'\n'+JSON.stringify(d,null,2));toast('Adapted: '+n,'success');});},
            bridge:function(r,d){api('GET','/patterns/bridge/demo').then(function(data){showResult('bridge-result',r+' â†’ '+d+'\n'+JSON.stringify(data,null,2));toast(r+' â†’ '+d,'success');});},
            composite:function(r,a){api('POST','/patterns/composite/rooms/'+encodeURIComponent(r)+'/control',{action:a}).then(function(d){showResult('composite-result',r+' '+a+'!\n'+JSON.stringify(d,null,2));toast(r+': '+a,'success');});},
            selectDecDevice:function(b,id){document.querySelectorAll('.device-item').forEach(function(x){x.classList.remove('active');});b.classList.add('active');decoratorDevice=id;this.updateDecoratorChain();},
            updateDecoratorChain:function(){var f=[];if(document.getElementById('dec-logging').checked)f.push('ğŸ“ Logging');if(document.getElementById('dec-security').checked)f.push('ğŸ” Security');if(document.getElementById('dec-caching').checked)f.push('âš¡ Caching');var c=document.getElementById('decorator-chain');var h='<span class="chain-item base">ğŸ“± '+decoratorDevice+'</span>';f.forEach(function(x){h+='<span class="chain-arrow">â†’</span><span class="chain-item decorator">'+x+'</span>';});c.innerHTML=h;},
            applyDecorators:function(){var d=[];if(document.getElementById('dec-logging').checked)d.push('LOGGING');if(document.getElementById('dec-security').checked)d.push('SECURITY');if(document.getElementById('dec-caching').checked)d.push('CACHING');if(d.length===0){toast('Select features!','error');return;}api('POST','/patterns/decorator/wrap',{deviceId:decoratorDevice,decorators:d.join(',')}).then(function(data){showResult('decorator-result','Decorated: '+decoratorDevice+'\n'+d.join(' â†’ ')+'\n'+JSON.stringify(data,null,2));toast('Decorated!','success');});},
            scene:function(n){api('POST','/patterns/facade/scene/'+n).then(function(d){showResult('facade-result','Scene: '+n+'\n'+JSON.stringify(d,null,2));toast('Scene: '+n,'success');});},
            flyweight:function(){api('GET','/patterns/flyweight/demo').then(function(d){showResult('flyweight-result','Flyweight Demo\nTypes shared: 4\nMemory saved: ~75%\n'+JSON.stringify(d,null,2));toast('Memory optimized!','success');});},
            proxy:function(){var n=document.getElementById('proxy-name').value,ip=document.getElementById('proxy-ip').value;this.quickProxy(n,ip);},
            quickProxy:function(n,ip){api('POST','/patterns/proxy/remote',{name:n,address:ip}).then(function(d){showResult('proxy-result','Proxy: '+n+' @ '+ip+'\n'+JSON.stringify(d,null,2));toast('Proxy: '+n,'success');});},
            alert:function(l,m){api('POST','/patterns/chain/alert',{deviceId:'sensor-1',level:l,message:m}).then(function(d){var c={INFO:'Log',WARNING:'Logâ†’Notify',CRITICAL:'Logâ†’Notifyâ†’Alarm',EMERGENCY:'Allâ†’911'};showResult('chain-result',l+': '+m+'\nChain: '+c[l]+'\n'+JSON.stringify(d,null,2));toast(l+': '+m,l==='INFO'?'info':'error');});},
            command:function(dev,cmd){api('POST','/patterns/command/execute',{deviceId:dev,command:cmd}).then(function(d){showResult('command-result',cmd+': '+dev+'\n'+JSON.stringify(d,null,2));toast(cmd+': '+dev,'success');});},
            undo:function(){api('POST','/patterns/command/undo').then(function(d){showResult('command-result','UNDO\n'+JSON.stringify(d,null,2));toast('Undone','info');});},
            redo:function(){api('POST','/patterns/command/redo').then(function(d){showResult('command-result','REDO\n'+JSON.stringify(d,null,2));toast('Redone','info');});},
            interpret:function(){var r=document.getElementById('interpreter-rule').value;api('POST','/patterns/interpreter/evaluate',{rule:r,light_is_on:'true',motion_detected:'true'}).then(function(d){showResult('interpreter-result','Rule: '+r+'\n'+JSON.stringify(d,null,2));toast('Evaluated','success');});},
            iterate:function(f,v){api('GET','/patterns/iterator/demo',{filterType:f,filterValue:v}).then(function(d){showResult('iterator-result',f+(v?' = '+v:'')+'\n'+JSON.stringify(d,null,2));toast('Listed','success');});},
            mediator:function(s,e){api('POST','/patterns/mediator/notify',{sourceDeviceId:s,event:e}).then(function(d){showResult('mediator-result','Hub: '+e+'\n'+JSON.stringify(d,null,2));toast('Event: '+e,'info');});},
            saveMemento:function(){var n=document.getElementById('memento-name').value;api('POST','/patterns/memento/save',{sceneName:n}).then(function(d){showResult('memento-result','Saved: '+n+'\n'+JSON.stringify(d,null,2));toast('Saved: '+n,'success');});},
            listMementos:function(){api('GET','/patterns/memento/list').then(function(d){showResult('memento-result','Snapshots:\n'+JSON.stringify(d,null,2));});},
            restoreMemento:function(){var n=document.getElementById('memento-name').value;api('POST','/patterns/memento/restore',{sceneName:n}).then(function(d){showResult('memento-result','Restored: '+n+'\n'+JSON.stringify(d,null,2));toast('Restored: '+n,'success');});},
            observer:function(dev,obs){api('POST','/patterns/observer/subscribe',{deviceId:dev,observerType:obs}).then(function(){api('POST','/patterns/observer/trigger',{deviceId:dev}).then(function(d){showResult('observer-result',obs+' â†’ '+dev+'\n'+JSON.stringify(d,null,2));toast(obs+' notified','info');});});},
            state:function(a){api('GET','/patterns/state/demo').then(function(d){document.getElementById('state-current').textContent=a.toUpperCase();showResult('state-result','State: '+a+'\n'+JSON.stringify(d,null,2));toast('State: '+a,'success');});},
            strategy:function(s){var pw={NORMAL:'100%',ECO:'70%',PERFORMANCE:'130%'};api('POST','/patterns/strategy/apply',{strategy:s}).then(function(d){document.getElementById('strategy-current').textContent=s;document.getElementById('strategy-power').textContent=pw[s];showResult('strategy-result','Strategy: '+s+'\n'+JSON.stringify(d,null,2));toast('Strategy: '+s,'success');});},
            template:function(t){api('POST','/patterns/template/init',{deviceType:t}).then(function(d){showResult('template-result','Init: '+t+'\n'+JSON.stringify(d,null,2));toast('Init: '+t,'success');});},
            visitor:function(t){api('GET','/patterns/visitor/audit',{type:t.toUpperCase()}).then(function(d){showResult('visitor-result',t+' Audit\n'+JSON.stringify(d,null,2));toast(t+' audit','success');});}
        };
        document.querySelectorAll('.nav-tab').forEach(function(tab){tab.addEventListener('click',function(){var p=this.dataset.pattern;document.querySelectorAll('.nav-tab').forEach(function(t){t.classList.remove('active');});this.classList.add('active');document.querySelectorAll('.pattern-card').forEach(function(c){c.classList.remove('active');});var t=document.getElementById('pattern-'+p);if(t)t.classList.add('active');});});
        document.querySelectorAll('#pattern-decorator input[type="checkbox"]').forEach(function(cb){cb.addEventListener('change',function(){P.updateDecoratorChain();});});
        toast('Smart Home loaded! 23 patterns ready.','success');
    </script>
</body>
</html>
