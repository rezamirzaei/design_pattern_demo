<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head('Smart Home ‚Äî Rooms')}"></head>
<body>
    <nav th:replace="~{fragments/layout :: navbar('rooms')}"></nav>
    <div th:replace="~{fragments/layout :: toasts}"></div>

    <main class="container" role="main">
        <header>
            <h1>üè¢ Rooms</h1>
            <p class="subtitle">Organize devices by room and control them as groups</p>
        </header>

        <section class="section" aria-label="Create room">
            <h2 class="section-title">‚ûï Create Room <span class="title-badge">Composite Pattern</span></h2>
            <div class="card">
                <form data-api-endpoint="/rooms/create" data-api-method="POST" data-refresh="true">
                    <div class="form-row">
                        <div>
                            <label for="roomName">Name</label>
                            <input id="roomName" name="name" placeholder="e.g. Living Room" required>
                        </div>
                        <div>
                            <label for="roomFloor">Floor</label>
                            <input id="roomFloor" name="floor" placeholder="e.g. 1">
                        </div>
                    </div>
                    <label for="roomType">Room Type</label>
                    <select id="roomType" name="roomType">
                        <option value="">‚Äî Select ‚Äî</option>
                        <option value="LIVING_ROOM">Living Room</option>
                        <option value="BEDROOM">Bedroom</option>
                        <option value="KITCHEN">Kitchen</option>
                        <option value="BATHROOM">Bathroom</option>
                        <option value="GARAGE">Garage</option>
                        <option value="GARDEN">Garden</option>
                        <option value="HALLWAY">Hallway</option>
                        <option value="OFFICE">Office</option>
                        <option value="OTHER">Other</option>
                    </select>
                    <button class="btn btn-primary" type="submit">
                        <span class="btn-icon">üè†</span> Create Room
                    </button>
                </form>
            </div>
        </section>

        <section class="section" aria-label="Room list">
            <h2 class="section-title">üìã Rooms</h2>

            <div th:if="${#lists.isEmpty(rooms)}" class="empty-state">
                <div class="empty-icon">üè¢</div>
                <h3>No rooms yet</h3>
                <p>Create a room above to start organizing your devices.</p>
            </div>

            <div class="grid" th:unless="${#lists.isEmpty(rooms)}">
                <div class="card" th:each="room : ${rooms}">
                    <div class="card-header">
                        <span class="card-title" th:text="${room.name}">Room Name</span>
                        <span class="badge" th:classappend="${room.deviceCount > 0} ? 'badge-active' : ''"
                              th:text="${room.deviceCount + ' device' + (room.deviceCount != 1 ? 's' : '')}">0 devices</span>
                    </div>

                    <p class="muted" th:if="${room.roomType != null || room.floor != null}">
                        <span th:if="${room.roomType != null}" th:text="${room.roomType}">‚Äî</span>
                        <span th:if="${room.floor != null}">
                            ‚Ä¢ Floor <span th:text="${room.floor}">1</span>
                        </span>
                    </p>

                    <details th:if="${room.deviceCount > 0}" style="margin-top:12px">
                        <summary style="cursor:pointer; color: var(--primary); font-weight: 600">
                            Show Devices
                        </summary>
                        <ul class="room-device-list">
                            <li th:each="dev : ${room.devices}">
                                <div class="room-device-item">
                                    <span>
                                        <span class="device-type-icon-sm" th:text="${dev.type.icon}">üí°</span>
                                        <span th:text="${dev.info}">Device</span>
                                    </span>
                                    <form class="inline-form" data-api-method="POST" data-refresh="true"
                                          th:attr="data-api-endpoint='/rooms/' + ${room.id} + '/unassign'">
                                        <input type="hidden" name="deviceId" th:value="${dev.id}">
                                        <button class="btn btn-secondary btn-small" type="submit">Remove</button>
                                    </form>
                                </div>
                            </li>
                        </ul>
                    </details>

                    <div th:if="${room.deviceCount == 0}" class="muted" style="margin-top:12px; text-align:center; padding:10px">
                        No devices assigned yet
                    </div>

                    <div style="margin-top: 14px;">
                        <form data-api-method="POST" data-refresh="true" th:attr="data-api-endpoint='/rooms/' + ${room.id} + '/assign'">
                            <div class="form-row">
                                <div>
                                    <label th:attr="for=${'deviceSelect-' + room.id}">Assign Device</label>
                                    <select name="deviceId" th:attr="id=${'deviceSelect-' + room.id}">
                                        <option th:each="device : ${devices}"
                                                th:value="${device.id}"
                                                th:text="${device.type.icon + ' ' + device.info}">Device</option>
                                    </select>
                                </div>
                                <div>
                                    <label>&nbsp;</label>
                                    <button class="btn btn-primary" type="submit">Assign</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>

        <div th:replace="~{fragments/layout :: outputLog}"></div>
    </main>

    <div th:replace="~{fragments/layout :: scripts}"></div>
    <footer th:replace="~{fragments/layout :: footer}"></footer>
</body>
</html>
